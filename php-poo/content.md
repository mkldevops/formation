name: inverse
class: center, middle, inverse
# Programmation Orient√©e Objet
# .red[PHP]
<div class="logo"><svg class="logo-1" fill="white" width="196" height="64" viewBox="0 0 196 64" style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2;"><g transform="matrix(0.101031,0,0,0.101031,2.39526,-0.329946)"><g transform="matrix(1.27705,0,0,1.27705,1143.65,155.404)"><path d="M320.958,94.576C320.958,107.301 317.357,117.884 310.155,126.323C302.952,134.763 293.386,140.971 281.456,144.947L331.695,223.685L290.072,223.685L246.727,150.647L230.025,150.647L230.025,223.685L193.837,223.685L193.837,40.361L247.787,40.361C296.568,40.361 320.958,58.433 320.958,94.576ZM283.312,94.576C283.312,84.855 280.462,77.764 274.762,73.301C269.062,68.838 260.38,66.607 248.715,66.607L230.025,66.607L230.025,124.931L249.908,124.931C260.954,124.931 269.283,122.501 274.895,117.641C280.506,112.78 283.312,105.092 283.312,94.576Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(1.27705,0,0,1.27705,1486.87,208.548)"><path d="M313.005,64.751L241.159,227.264L208.153,217.058L277.612,67.402L195.163,67.402L195.163,40.361L313.005,40.361L313.005,64.751Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(1.27705,0,0,1.27705,1335.53,155.404)"><path d="M253.752,12.524C257.994,12.524 261.75,13.43 265.019,15.241C268.289,17.053 270.852,19.55 272.708,22.731C274.563,25.912 275.491,29.447 275.491,33.335C275.491,37.224 274.563,40.758 272.708,43.94C270.852,47.121 268.289,49.64 265.019,51.495C261.75,53.351 257.994,54.279 253.752,54.279C249.51,54.279 245.733,53.351 242.419,51.495C239.105,49.64 236.52,47.121 234.664,43.94C232.808,40.758 231.88,37.224 231.88,33.335C231.88,29.447 232.808,25.912 234.664,22.731C236.52,19.55 239.105,17.053 242.419,15.241C245.733,13.43 249.51,12.524 253.752,12.524ZM201.658,83.309L276.419,83.309L276.419,198.897L313.402,198.897L313.402,223.685L200.332,223.685L200.332,198.897L241.424,198.897L241.424,108.097L201.658,108.097L201.658,83.309Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M261.043,177.319L211.622,177.319L211.622,218.681L254.382,218.681L254.382,228.302L211.622,228.302L211.622,271.803L264.332,271.803L264.332,280.93L201.096,280.93L201.096,167.944L262.441,167.944L261.043,177.319ZM213.76,150.758L245.501,134.23L250.682,143.851L216.72,156.432L213.76,150.758Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M312.861,273.201C321.248,273.201 329.06,270.651 336.297,265.553L341.642,272.46C337.969,275.53 333.501,277.984 328.238,279.82C322.975,281.657 317.987,282.575 313.272,282.575C304.994,282.575 297.922,280.766 292.056,277.148C286.191,273.529 281.723,268.376 278.653,261.688C275.583,255 274.048,247.133 274.048,238.088C274.048,229.426 275.583,221.696 278.653,214.898C281.723,208.101 286.218,202.756 292.139,198.863C298.059,194.971 305.131,193.025 313.354,193.025C323.935,193.025 333.282,196.287 341.395,202.81L335.968,210.129C328.128,204.757 320.426,202.07 312.861,202.07C307.488,202.07 302.733,203.441 298.594,206.182C294.455,208.923 291.22,212.993 288.89,218.393C286.561,223.793 285.396,230.358 285.396,238.088C285.396,245.927 286.547,252.465 288.849,257.7C291.152,262.935 294.373,266.828 298.512,269.377C302.65,271.926 307.434,273.201 312.861,273.201Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M386.388,193.025C394.118,193.025 400.641,194.834 405.959,198.452C411.277,202.07 415.251,207.224 417.883,213.912C420.514,220.6 421.83,228.549 421.83,237.759C421.83,246.421 420.473,254.137 417.759,260.907C415.046,267.677 411.003,272.981 405.63,276.819C400.258,280.656 393.761,282.575 386.141,282.575C378.412,282.575 371.874,280.725 366.529,277.024C361.184,273.324 357.168,268.13 354.482,261.441C351.796,254.753 350.453,246.914 350.453,237.923C350.453,228.987 351.81,221.148 354.523,214.405C357.237,207.662 361.294,202.413 366.694,198.658C372.093,194.903 378.658,193.025 386.388,193.025ZM386.388,201.988C369.887,201.988 361.636,213.967 361.636,237.923C361.636,261.661 369.805,273.529 386.141,273.529C402.478,273.529 410.646,261.606 410.646,237.759C410.646,213.912 402.56,201.988 386.388,201.988Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M463.945,261.359C463.945,265.635 465.301,268.76 468.015,270.734C470.729,272.707 474.443,273.694 479.157,273.694C483.982,273.694 489.053,272.652 494.37,270.569L497.33,278.463C494.973,279.669 492.136,280.656 488.82,281.424C485.503,282.191 481.953,282.575 478.171,282.575C473.566,282.575 469.413,281.739 465.713,280.067C462.012,278.395 459.093,275.955 456.955,272.748C454.817,269.541 453.748,265.745 453.748,261.359L453.748,168.52L426.94,168.52L426.94,159.639L463.945,159.639L463.945,261.359Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M520.121,241.87C520.231,248.833 521.491,254.657 523.904,259.345C526.316,264.032 529.509,267.513 533.483,269.788C537.458,272.063 541.885,273.201 546.764,273.201C551.15,273.201 555.11,272.57 558.646,271.309C562.182,270.048 565.979,268.02 570.035,265.224L575.38,272.872C571.433,275.942 566.952,278.326 561.936,280.026C556.919,281.725 551.999,282.575 547.175,282.575C539.336,282.575 532.552,280.725 526.823,277.024C521.094,273.324 516.722,268.102 513.707,261.359C510.692,254.616 509.184,246.777 509.184,237.841C509.184,229.125 510.705,221.381 513.748,214.611C516.791,207.84 521.08,202.55 526.617,198.74C532.154,194.93 538.486,193.025 545.613,193.025C552.52,193.025 558.496,194.711 563.539,198.082C568.583,201.454 572.434,206.278 575.093,212.555C577.751,218.832 579.081,226.246 579.081,234.798C579.081,236.059 578.999,238.417 578.834,241.87L520.121,241.87ZM545.859,202.564C541.09,202.564 536.855,203.674 533.155,205.894C529.454,208.114 526.48,211.472 524.232,215.967C521.985,220.463 520.669,226.027 520.285,232.66L569.377,232.66C569.158,222.793 566.938,215.31 562.717,210.211C558.496,205.113 552.876,202.564 545.859,202.564Z" style="fill-rule: nonzero;"></path></g><path d="M250.428,75.558C385.339,75.558 494.87,185.089 494.87,320C494.87,454.911 385.339,564.442 250.428,564.442C115.517,564.442 5.986,454.911 5.986,320C5.986,185.089 115.517,75.558 250.428,75.558ZM131.233,450.023L131.233,203.31L220.202,205.493C297.709,207.676 311.355,209.314 331.55,219.685C400.87,255.709 417.79,343.587 365.937,402.536L344.65,426.552L356.658,438.014L368.12,450.023L256.772,450.023L256.772,339.22L269.872,351.228L282.972,363.782L294.434,352.32C308.08,338.674 309.171,325.575 297.163,309.2C294.835,305.797 292.624,303.334 289.625,301.561C283.483,297.931 274.034,297.192 253.497,297.192L218.564,297.192L218.564,450.023L131.233,450.023Z"></path></g></svg></div>

---

class: middle
.left-column[
### Objectif
]
.right-column[
- D√©couvrir un peu plus PHP

- Maitriser les bases de la POO

- Vous permettre de r√©pondre aux besoins de votre entreprise

- Gagner en confiance et motivation
]

---
class: middle
.left-column[
### Objectif
### Pr√©requis

]
.right-column[
- Version **PHP >=7.4** (avec laragon, lamp, wamp, ...)

- Avoir les bases de PHP (variable, if, for, while, ...)

- √âditeur de texte (vs-code, phpstorm, sublime-text, ...)

- Shell terminal avec le client `php-cli`

- clone du repo git pour les TP, qui vous permettra de faire le suivi du cours √† differente √©tape.

```sh
git clone https://github.com/mkldevops/php-poo-tp.git -b 1.0
```
]

---

class: middle
.left-column[
### Objectif
### Requis
### Pourquoi la POO ?
]
.right-column[
La programmation orient√©e objet (POO) est devenue **l'un des √©l√©ments constitutifs de la programmation**, qui remplace ou am√©liore la programmation proc√©durale. Alors que l'id√©e plus traditionnelle de la programmation proc√©durale place l'action et la logique au centre, **la POO utilise des objets et des donn√©es pour produire des r√©sultats.**

Au niveau le plus simple, la POO se concentre sur les objets qu'un programmeur souhaite modifier plut√¥t que sur les actions n√©cessaires pour effectuer ce changement. Cela **facilite l'ex√©cution d'analyses de code** par les programmeurs et ces objets sont **r√©utilisables dans d'autres projets.**

La majorit√© des langages de programmation modernes tels que C++, Object Pascal, Java, Python et PHP combinent √† la fois la programmation orient√©e objet et la programmation proc√©durale, ce qui signifie que la programmation orient√©e objet est devenue une √©volution tr√®s importante dans le monde de la programmation.
]

---

class: middle
.left-column[
### Objectif
### Requis
### Pourquoi la POO ?
### Stats des versions PHP
]

.right-column[
  üìä La derni√®re version de PHP √† ce jour est la version 8.1 qui √† √©t√© publi√© en Novembre 2021

| Version | juillet 2021 (%) | janvier 2022 (%) |
|-------------|------------------|------------------|
| **8.1**     | 0,1              | 9.1              |
| **8.0**     | 14.7             | 23,9             |
| **7.4**     | 46,8             | 43,9             |
| **7.3**     | 19.2             | 12.0             |
| **7.2**     | 10.4             | 6.6              |
| **7.1**     | 3.8              | 2.4              |
| **7.0**     | 1.3              | 0,8              |

On remarque que la communaut√© utilisant PHP suivent et migre vers les derniers versions.
]

---

class: middle
.left-column[
### Objectif
### Requis
### Pourquoi la POO ?
### Stats des versions PHP
### Au programme
]

.right-column[
- **Organisation du code**
  - Les classes
  - Propri√©t√©s d'une classe
  - M√©thodes d'une classe

* **L'encapsulation, S√©curit√© du code (int√©grit√©)**
  - Visibilit√© Private
  - Accesseurs & Mutateurs
  - Le constructeur
  - M√©thodes magiques
  - Propri√©t√©s et M√©thodes static
  - Constante

- **R√©utilisation du code et gain de temps**
  - H√©ritage
  - Mot cl√© extends
  - Visibilit√© protected
  - Mot cl√© final
  - Trait

* **Plus de contr√¥le sur votre d√©veloppement**
  - Interfaces
  - Abstraction
  - Polymorphisme
  - Namespace
  - Exceptions

* **L'auto-chargement des classes**
  - Autoloader
  - Composer

* **Le typage de donn√©es**
  - PHP Doc
  - Typage de donn√©es
  - Type callable
  - Types d'Union
  - Arguments nomm√©es

* **PHP 8** (nouveaut√©s)
  ]

---

class: middle

### Analysons un cas

**La soci√©t√© R** souhaite un programme afin d'organiser son personnel, elle fait appel √† un d√©veloppeur qui √©crit le code suivant :

.pull-left[

```php
$nom1 = 'Hamada';
$prenom1 = 'Fahari';
$age1 = 35;
$anciennete1 = 12;

$nom2 = 'Dupont';
$prenom2 = 'Michel';
$age2 = 50;
$anciennete2 = 20;

function presentation($nom, $prenom, $age, $anciennete)
{
  echo "Mon nom est $nom, mon prenom est $prenom,
    j'ai $age ans
    je travail depuis $anciennete ans.\n\r";
}

presentation($nom1, $prenom1, $age1, $anciennete1);
presentation($nom2, $prenom2, $age2, $anciennete2);
```

]
.pull-right[
]
---

class: middle

### Analysons un cas

La soci√©t√© R souhaite un programme afin d'organiser son personnel, elle fait appel √† un d√©veloppeur qui √©crit le code suivant :

.pull-left[

```php
$nom1 = 'Hamada';
$prenom1 = 'Fahari';
$age1 = 35;
$anciennete1 = 12;

$nom2 = 'Dupont';
$prenom2 = 'Michel';
$age2 = 50;
$anciennete2 = 20;

function presentation($nom, $prenom, $age, $anciennete)
{
  echo "Mon nom est $nom, mon prenom est $prenom,
    j'ai $age ans
    je travail depuis $anciennete ans.\n\r";
}

presentation($nom1, $prenom1, $age1, $anciennete1);
presentation($nom2, $prenom2, $age2, $anciennete2);
```

]
.pull-right[
On remarque qu'avec le code present√© :

- Nous avons **beaucoup de variables** pour repr√©senter les donn√©es d'un employ√©.

- Une gestion de **nouveaux employ√©s qui se complique.**

- Il est aussi possible que nous puissions** m√©langer les variables.**

- Au final, **un code surcharg√© et difficile √† maintenir**
]

---

class: middle, center, inverse

# 1. Organisation du code

---

.left-column[
### Les classes
]
.right-column[
**Une classe est une d√©finition ou une repr√©sentation de quelque chose**. La classe va contenir des propri√©t√©s qu‚Äôon pourra manipuler ainsi que des m√©thodes.

[![](https://mermaid.ink/img/pako:eNpNj8sKAjEMRX-lZKWoP9C1foHgqpvYZsZAH5Kmggzz785L9K7CuYeEDOBLILDgI9Z6ZuwFk8tmykLMrbA2ITOscM6Js5oXK9VKf7SqcO6NR7k3way_6iClRZLd3qzO2oxwhESSkMN0f9nvQB-UyIGdxkAdtqgOXJ7V9gyodAmsRcB2GCsdAZuW6zt7sCqNvtL2xmaNH2-nSos)](https://mermaid-js.github.io/mermaid-live-editor/edit#pako:eNpNj8sKAjEMRX-lZKWoP9C1foHgqpvYZsZAH5Kmggzz785L9K7CuYeEDOBLILDgI9Z6ZuwFk8tmykLMrbA2ITOscM6Js5oXK9VKf7SqcO6NR7k3way_6iClRZLd3qzO2oxwhESSkMN0f9nvQB-UyIGdxkAdtqgOXJ7V9gyodAmsRcB2GCsdAZuW6zt7sCqNvtL2xmaNH2-nSos)

- **Les propri√©t√©s (attributs),** ce sont des variables internes √† cette d√©finition dans lesquelles on stocke des valeurs.

- **Une classe a aussi des m√©thodes,** il s‚Äôagit de fonctions internes √† la classe. Les methode represente le comportement qu'aura notre d√©finition.

Ainsi **La classe d√©termine ce qu'il sera possible de faire** avec ce qu'elle repr√©sente. 

Elle va donc nous permettre de structurer et d'organiser l‚Äôensemble de notre code pour le rendre plus solide et facile √† entretenir ou √† faire √©voluer.
]

---

.left-column[
### Les classes
#### D√©claration de la classe
]
.right-column[
Une classe se d√©clare de la mani√®re suivante :

```php
<?php

class Voiture
{

}
```



_**Note : **_ 
>* Le mot cl√© **`class`** est suivi d'un nom en **`PascalCase`**, Prenez soin de nommer votre classe de mani√®re pertinente.
>
>* Le **`PascalCase`** est une convention de d√©nomination dans laquelle la premi√®re lettre de chaque mot d'un mot compos√© est en majuscule. C'est utilis√© pour nommer des fonctions , des classes et d'autres objets.<br/>
> `PascalCase` est similaire √† `camelCase`, sauf que la premi√®re lettre de `PascalCase` est toujours en majuscule. Voici quelques exemples.

>   * **`PascalCase`** : `NomDeMaClasse` ;
>   * **`camelCase`** : `nomDeMaClasse` ;
]

---

.left-column[
### Les classes
#### D√©claration de la classe
#### Instanciation d'une classe
]
.right-column[
**Cr√©er une instance**, c'est cr√©er un objet √† partir d'une classe. 

On utilise le mot `new` pour instancier une classe. Cette instanciation sera alors affecter √† une variable qui deviendra donc notre objet de type `Voiture` üöò. 

**Exemple d‚Äôinstanciation:**

```php
# cours/index.php
<?php

class Voiture
{

}

$mercedes = new Voiture();

var_dump($mercedes);

```

Lan√ßons le script via la commande PHP
```sh
php cours/index.php
# object(Voiture)#1 (0) { }
```

üìå A savoir qu'au moment d'une nouvelle instanciation de classe, une **r√©ference d'objet** est mise en place par PHP.
]
---

.left-column[
### Les classes
#### D√©claration de la classe
#### Instanciation d'une classe
#### R√©f√©rence d'objet
]

.right-column[
Une **¬´ r√©f√©rence ¬ª** en PHP ou plus pr√©cis√©ment un **alias** est un moyen d‚Äôacc√©der au contenu d‚Äôune m√™me variable en utilisant un autre nom. 

Pour le dire simplement, cr√©er un alias signifie d√©clarer un autre nom de variable qui va partager la m√™me valeur que la variable de d√©part.

Notez qu‚Äôen PHP le nom d‚Äôune variable et son contenu ou sa valeur sont identifi√©s comme deux choses distinctes par le langage. Cela permet donc de donner plusieurs noms √† un m√™me contenu.

Ainsi, lorsque l‚Äôon modifie la valeur de l‚Äôalias, on modifie √©galement la valeur de la variable de base puisque ces deux √©l√©ments partagent la m√™me valeur.

.pull-left[
**D√©claration par r√©f√©rence avec `&`**

```php
function foo(&$var)
{
    $var = 2;
}

$a = 1;
foo($a);

// $a vaut 2 maintenant
var_dump(compact('a'));
```

]
.pull-right[
**D√©claration par reference avec l'instanciation**

```php
$date1 = new DateTime();
$date2 = $date1;
$date3 = clone $date1;
$date2->modify('+1 day');

var_dump(compact('date1', 'date2', 'date3'));
```

`$date1` et `$date2` d√©signent le m√™me objet en m√©moire. Ils sont donc tous les deux au lendemain.
]
]
---


.left-column[
### Les classes
#### D√©claration de la classe
#### Instanciation d'une classe
#### R√©f√©rence d'objet
### Propri√©t√©s d'une classe
]

.right-column[
**Les propri√©t√©s** (Appel√© parfois attribut) sont les variables membres de la classe. Ils constituent les caract√©ristiques de l'objet. En quelque sorte c‚Äôest ce qui le d√©finit.

```php
class Voiture
{
  $vitesse = 100;
  $carburant = 'diesel';
}
```
]

---

.left-column[
### Les classes
#### D√©claration de la classe
#### Instanciation d'une classe
#### R√©f√©rence d'objet
### Propri√©t√©s d'une classe
]

.right-column[
**Les propri√©t√©s** (Appel√© parfois attribut) sont les variables membres de la classe. Ils constituent les caract√©ristiques de l'objet. En quelque sorte c‚Äôest ce qui le d√©finit.

```php
class Voiture
{
  $vitesse = 100;
  $carburant = 'diesel';
}
```

‚ö° Pour d√©clarer un attribut il faut le pr√©c√©der par sa **visibilit√©**.

üëÄ **La visibilit√©** d'un attribut indique √† partir d'o√π on peut y avoir acc√®s.
**`public`** est un type de visibilit√© qui permet √† l'attribut d'√™tre accessible de partout (de l'int√©rieur de la classe dont il est membre comme de l'ext√©rieur).

```php
class Voiture
{
  public $vitesse = 100;
  public $carburant = 'diesel';
}

$mercedes = new Voiture();
var_dump($mercedes);

$mercedes->vitesse = 120;
$mercedes->carburant = 'ethanol';
var_dump($mercedes);
```

On utilise l‚Äôop√©rateur `->` pour avoir acc√®s **aux propri√©t√©s et m√©thodes** de l'objets instanci√©.
]

---


.left-column[
### Les classes
#### D√©claration de la classe
#### Instanciation d'une classe
#### R√©f√©rence d'objet
### Propri√©t√©s d'une classe
### M√©thodes d'une classe
]
.right-column[
Nous allons √©galement pouvoir d√©clarer des fonctions √† l‚Äôint√©rieur de nos classes. 

Les fonctions d√©finies √† l‚Äôint√©rieur d‚Äôune classe sont appel√©es des **m√©thodes**. Les m√©thodes de classes vont donc √™tre ce qui d√©fini le comportement de notre objet.

```php
class Voiture
{
  public $vitesse = 100;
  public $carburant = 'diesel';

  public function rouler()
  {
    echo 'Voiture '.$this->carburant.', roulant √† '.$this->vitesse.' KM/h';
  }
}

$mercedes  = new Voiture();
$mercedes->rouler();
```

üîµ Vous remarquez que pour utiliser les propri√©t√© de la classe nous utilise le mot cl√© `$this`. La pseudo-variable `$this` est disponible lorsqu'une m√©thode est appel√©e depuis un contexte objet. `$this` est la valeur de l'objet appelant.

**Note :** 
> Par d√©faut la m√©thode √† une visibilit√© `public`, on pourrait donc ne pas le mentionner mais par convention il est mieux de le d√©finir.
]
---

.left-column[
### Les classes
#### D√©claration de la classe
#### Instanciation d'une classe
#### R√©f√©rence d'objet
### Propri√©t√©s (attributs) d'une classe
### M√©thodes d'une classe
### .red[**üèó T. P.**]
]

.right-column[

Lors des travaux pratique nous utiliserons le dossier `/societe-r` comme repertoire racine.

Un fichier `index.php` y est pr√©sent avec le code que nous avons analys√© lors du d√©but de la formation.

- Lancer notre serveur PHP avec `php -S localhost:8000 societe-r/index.php`

Une fois notre serveur pr√™t, appliquons le POO sur le cas analys√© appartenant √† la **Soci√©t√© R**

- D√©finir une nouvelle classe `Employe` et ses propri√©t√©s public `id`, `nom`, `prenom`, `age` et `anciennete`

- Faite en sorte que l'employ√© puisse se pr√©senter avec une m√©thode `presentation()`

- D√©finir 3 instances d'employ√©s differentes avec un `id` unique. Chaque instance se presentera avec la methode `presentation()`
  
- Ajouter aleatoirement √† chaque instance d'employ√© entre 5 et 10 ans d'anciennet√©.

- Ajouter une classe `Equipe` qui aura une propri√©t√© public `nom` et `employes` qui sera un tableau de `Employe`

- Ajouter nos employ√©s instanci√© dans une Equipe nomm√© `Dream Team`
]

---

class: middle, center, inverse

# 2. L'encapsulation

---

.left-column[
### Visibilit√© private
]
.right-column[
Nous avons d√©finit les attributs avec un visibilit√© `public` et peuvent √™tre modifi√© par n'importe qui et n'importe o√π, √† un autre endroit dans le code.

Pour rem√©dier √† cela on va utiliser le concept **d'encapsulation** afin de prot√©ger certaines donn√©es des interf√©rences ext√©rieures en se for√ßant √† utiliser les m√©thodes d√©finies pour manipuler les donn√©es. 

üõ° **L‚Äôencapsulation** va ici √™tre tr√®s int√©ressante pour emp√™cher que certaines propri√©t√©s ne soient manipul√©es depuis l‚Äôext√©rieur de la classe.

Nous allons donc utiliser la visibilit√© **`private`** au niveau de nos propri√©t√©s.

```php
class Voiture
{
  private $vitesse = 100;
  private $carburant = 'diesel';

  ...
}
```

üîµ La propri√©t√© `private` ne va √™tre uniquement accessibles depuis l‚Äôint√©rieur de la classe. Pour y avoir acces on utilisera **les accesseurs** et pour modifier **les mutateurs**.
]

---

.left-column[
### Visibilit√© private
### Les accesseurs et mutateurs
]
.right-column[
.pull-left[
Ayant modifi√© la visibilit√© des propri√©t√©s de la classe sur la valeur **`private`**. Il n'est plus possible d'acc√®der directement aux propri√©t√© d'un objet instanci√© en dehors de la classe.

Pour y remedier et pouvoir lire et modifier leurs valeurs, on passe par des m√©thodes publiques.

Ces m√©thodes se nommes :
* **accesseurs** (**`getter`**) pour lire leurs valeurs 
* **mutateurs** (**`setter`**) pour modifier leurs valeurs.

Une des conventions souvent utilis√©e est de reprendre le nom de la propri√©t√© pour d√©finir le nom des m√©thodes, en ajoutant `get` pour les accesseurs et `set` pour les mutateurs. Tout en en utilisant le `camelCase` comme convention de nommage.
]
.pull-right[

```php
class Voiture
{
  private $vitesse = 100;
  private $carburant = 'diesel';

  ...

  public function setVitesse($vitesse)
  {
    $this->vitesse = $vitesse;
  }

  public function getVitesse()
  {
    return $this->vitesse;
  }

  public function setCarburant($carburant)
  {
    $this->carburant = $carburant;
  }

  public function getCarburant()
  {
    return $this->carburant;
  }
}
```
]
]

---

.left-column[
### Visibilit√© private
### Les accesseurs et mutateurs
]
.right-column[
Pour pouvoir donc modifier les information de notre objet, on passera par les accesseurs et mutateurs, qui sont m√©thodes d√©clar√© public de l'objet.

```php
$mercedes = new Voiture();
$mercedes->setCarburant('essence');
$mercedes->setVitesse(120);
$mercedes->rouler();
```

Nous pouvons ainsi s√©curiser la modification de nos propri√©t√©s.

**Exemple :** On ne souhaite modifier le carburant que si la nouvel valeur est parmi "`diesel`", "`essence`" ou "`ethanol`".

```php
class Voiture
{
  ...

  public function setCarburant($carburant)
  {
    if(in_array($carburant, ['diesel', 'essence', 'ethanol'])) {
      $this->carburant = $carburant;
    }
  }
}

$mercedes = new Voiture();
$mercedes->setCarburant('eau');
var_dump($mercedes);
```
]

---

.left-column[
### Visibilit√© private
### Les accesseurs et mutateurs
### Le constructeur
]
.right-column[
  PHP permet de d√©clarer des constructeurs pour les classes via la fonction magique `__construct()`. 
  
  Les classes qui poss√®dent cette m√©thode l'appellent √† chaque initition de nouvel instance d'objet, ce qui est int√©ressant pour toutes les initialisations dont l'objet a besoin avant d'√™tre utilis√©.

  ```php
  class Voiture
  {
    private $vitesse = 100;
    private $carburant = 'diesel';

    public function __construct($vitesse = null, $carburant = null)
    {
      if($vitesse !== null) {
        $this->vitesse = $vitesse;
      }
      
      $this->setCarburant($carburant);
    }

    # getters & setters ...
  }

  $mercedes = new Voiture();
  $scenic = new Voiture(90, 'ethanol');

  var_dump(compact('scenic', 'mercedes'));
  ```
]
---

.left-column[
  ### Visibilit√© private
  ### Les accesseurs et mutateurs
  ### Le constructeur
  ### .red[**üèó T. P.**]
]
.right-column[
  .left[
  Reprenons le projet de la **Soci√©t√© R**. Continuons √† am√©liorer le code en appliquant ce qu'on a appris sur les chapitres pr√©cedents

  - D√©placer les classes `Employe` et `Equipe` dans des fichiers php sp√©cifique `Employe.php` et `Equipe.php` et faire un `require_once`  des 2 fichiers.

  - Appliquer le pricinpe d'encapsulation sur les classes `Employe` et `Equipe`

  - D√©finir les constructeur pour pouvoir aussi y d√©finir directement les valeurs des propri√©t√©s lors de l'instanciation

  - Generer automatiquement l'`id` lors de l'instanciation.
  
  - Ajouter 3 nouveaux employ√©s qui seront dans un nouvelle √©quipe `Rocket Team` en utilisant seulement le constructeur.

  - S√©curiser nos m√©thodes afin de respecter les regles suivantes :
  
    - Un employ√© doit avoir par defaut 18 ans et 0 ann√©es d'anciennet√©.
    
    - Un employ√© doit avoir entre **0** et **47** ann√©es d'anciennet√©s

    - Un employ√© doit avoir entre **18 ans** minimum et **65 ans** maximum


  .center[üíªüíªüíªüíª]
  ]
]

---

.left-column[
  ### Visibilit√© private
  ### Les accesseurs et mutateurs
  ### Le constructeur
  ### .red[**üèó T. P.**]
  ### M√©thodes magiques
]
.right-column[
  Les m√©thodes magiques sont des m√©thodes qui, si elles sont d√©clar√©es dans une classe, ont une fonction d√©j√† pr√©vue par le langage.

  - **`__construct()` :** Methode appel√© lors de la construction de l'objet (instanciation).
  - **`__destruct()` :** Methode appel√© lors de la destruction de l'objet (`unset()`).
  - **`__set()` :** D√©clench√©e lors de l'acc√®s en √©criture √† une propri√©t√© de l'objet.
  - **`__get()` :** D√©clench√©e lors de l'acc√®s en lecture √† une propri√©t√© de l'objet.
  - **`__call()` :** D√©clench√©e lors de l'appel d'une m√©thode inexistante de la classe (appel non statique).
  - **`__callstatic()` :** D√©clench√©e lors de l'appel d'une m√©thode inexistante de la classe (appel statique).
  - **`__isset()` :** D√©clench√©e si on applique `isset()` √† une propri√©t√© de l'objet.
  - **`__unset()` :** D√©clench√©e si on applique `unset()` √† une propri√©t√© de l'objet.
  - **`__sleep()` :** Ex√©cut√©e si la fonction `serialize()` est appliqu√©e √† l'objet.
  - **`__wakeup()` :** Ex√©cut√©e si la fonction `unserialize()` est appliqu√©e √† l'objet.
  - **`__toString()` :** Appel√©e lorsque l'on essaie d'afficher directement l'objet : `echo $object.`
  - **`__set_state()` :** M√©thode statique lanc√©e lorsque l'on applique la fonction `var_export()` √† l'objet
  - **`__clone()` :** Appel√©s lorsque l'on essaie de cloner l'objet ;
  - **`__autoload()` :** Cette fonction n'est pas une m√©thode, elle est d√©clar√©e dans le scope global et permet d'automatiser les `"include/require"` de classes PHP.
]

---

.left-column[
  ### Visibilit√© private
  ### Les accesseurs et mutateurs
  ### Le constructeur
  ### .red[**üèó T. P.**]
  ### M√©thodes magiques
  ### Propri√©t√©s et M√©thodes static
]
.right-column[
  **Les propri√©t√©s et m√©thodes statiques appartiennent √† la classe et non √† l'objet**. Par cons√©quent on ne peut pas y acc√©der par l'op√©rateur `->` mais plut√¥t par l'op√©rateur de r√©solution de port√©e `::` pr√©c√©d√© par le nom de la classe dans laquelle ils sont d√©finis.

  Pour **sp√©cifier si une propri√©t√© est statique** on d√©clare le mot cl√© `static` apr√®s la visibilit√©.
  La valeur d'une propri√©t√© statique peut √™tre modifi√©, tout au long du processus, apr√®s l'avoir d√©fini dans la classe.

  Par exemple:

  ```php
  class Voiture
  {
    public static $nbPortes = 5;

    ...

    public static function ajouterPortes()
    {
      self::$nbPortes++;
      return sprintf("Une voiture avec %d portes", self::$nbPortes);
    }
  }

  var_dump([Voiture::$nbPortes, Voiture::ajouterPortes()]);
  ```

  **Note :** On utilise un nouveau mot cl√© **`self`**. Dans la d√©finition d‚Äôune classe, ¬´ `$this` ¬ª se r√©f√®re √† l‚Äôobjet actuel, tandis que ¬´ `self` ¬ª se r√©f√®re √† la classe actuelle.
]

---

.left-column[
  ### Visibilit√© private
  ### Les accesseurs et mutateurs
  ### Le constructeur
  ### .red[**üèó T. P.**]
  ### M√©thodes magiques
  ### Propri√©t√©s et M√©thodes static
  ### Constante
]
.right-column[
  Une constante de classe est un √©l√©ment statique par d√©faut. Son r√¥le est le m√™me que celui d'une constante classique d√©clar√©e √† l'aide de la fonction `define()`. **Sa valeur est inchang√©e, contrairement √† la propri√©t√© statique** et elle appartient aussi √† la classe dans laquelle est elle d√©clar√© et non √† l'objet qui constitue l'instance de classe.

  Pour d√©finir une **constante**, on utilise le mot cl√© **`const`** suivi du nom de la constante √† laquelle on affecte la valeur souhait√©e. Par convention l'identifiant de la constante est d√©clar√© en **majuscule**.

  La constante de classe peut √™tre appel√©e de l'int√©rieur comme de l'ext√©rieur de la classe gr√¢ce √† l'op√©rateur de r√©solution de port√©e **`::`**

  ```php
  class Voiture
  {
    const NB_ROUES = 4;

    ...

    public function rouler()
    {
      return 'Voiture '.$this->carburant.', roulant √† '.$this->vitesse.' KM/h avec '.
      self::NB_ROUES.' roues';
    }
  }

  $mercedes = new Voiture();

  var_dump([Voiture::NB_ROUES, $mercedes->rouler()]);
  ```
]

---

.left-column[
  ### Visibilit√© private
  ### Les accesseurs et mutateurs
  ### Le constructeur
  ### .red[**üèó T. P.**]
  ### M√©thodes magiques
  ### Propri√©t√©s et M√©thodes static
  ### Constante
  ### .red[**üèó T. P.**]
]
.right-column[
  Reprenons notre projet fil rouge avec la soci√©t√© R.

  - Ajouter √† la classe `Equipe` une constante `NB_EMPLOYE_MAX` qui aura comme valeur 5, qui correspond √† la limite du nombre d'employ√© dans une √©quipe.

  - Modifier la methode `setEmployes` pour `ajouterEmploye` :
    - Elle pendra en parametre un seul `Employe`.
    - Elle devra verifier que le nombre maximum d'employ√© n'est pas atteint pour ajouter un employe
    - Etre utilis√© au niieau du constructeur avec un `foreach`

  - Ajouter une propri√©t√© priv√© statique `$nbHeuresTravails` dans les classe `Equipe` qui aura comme valeur 0.

  - Ajouter une fonction `travailler` √† la classe `Equipe` : 
    - Qui aura en parametre le nombre d'heure `$nbHeures` travaill√© par personnes.
    - Elle ajoutera pour chaque `Employe` dans l'√©quipe, le nombre d'heure dans `$nbHeuresTravails`
    - Faire travailler l'√©quipe "Rocket Team" 8 heures / employes
    - Faire travailler l'√©quipe "Dream Team" 7 heures / employes
    - Afficher le nombre d'heures travaill√© par les deux √©quipes via une methode static `getbHeuresTravails`.

  - Pour chaque √©quipe, afficher le pourcentage d'employ√© par rapport √† la limite max.
]

---

class: middle, center, inverse

# 3. R√©utilisation du code et gain de temps

---

.left-column[
  ## H√©ritage
]
.right-column[
  L'h√©ritage est un concept fondamental de la POO. C'est d'ailleurs l'un des plus importants puisqu'il permet de r√©utiliser le code d'une classe autant de fois que l'on souhaite tout en ayant la libert√© d'en modifier certaines parties.

  **Voyons notre exemple :**

  Nous disposons d'une classe du nom de **`Vehicule`**. Si on cr√©e une classe du nom de **`Voiture`** qui h√©rite de **`Vehicule`**, alors **`Voiture`** h√©rite de tous les membres (attributs et m√©thodes) qui constituent **`Vehicule`**.

  Autrement dit, si on instancie **`Voiture`**, alors tous les attributs et m√©thodes de **`Vehicule`** peuvent √™tre appel√©s √† partir de l'objet cr√©√© (l'instance de **`Voiture`**). Bien entendu, il faut que les membres appel√©s soient publiques.

  Dans ce cas on dit que **`Vehicule`** est la classe **m√®re** et **`Voiture`** est la classe **fille**.

  .center[
    ![image](https://1.bp.blogspot.com/-cXfyqZkLIMM/XhGG_h1bdnI/AAAAAAAAIJ4/p9eNBPXn8AMFgwjboNiqqYE4uQVYgIyLACNcBGAsYHQ/s1600/poo.png)
  ]
]

---

.left-column[
  ## H√©ritage
  ### Mot cl√© extends
]
.right-column[
  Pour proc√©der √† l'h√©ritage, on fait appel au mot cl√© **`extends`**, apr√®s le nom de la classe comme ceci:

  ```php
  class Vehicule 
  { 
    
  }

  class Voiture extends Vehicule 
  { 
    # codes
  }

  class Camion extends Vehicule 
  { 
    
  }
  ```
  Nos classes **`Voiture`** et **`Camion`** √©tendent de la classe **`Vehicule`**. 
  
  Elles h√©ritent et vont pouvoir acc√©der √† toutes les m√©thodes et aux propri√©t√©s de la classe `Vehicule` qui n‚Äôont pas √©t√© d√©finies avec le mot cl√© **`private`**.
]

---

.left-column[
  ## H√©ritage
  ### Mot cl√© extends
  ### Visibilit√© protected
]
.right-column[
  Avec la visibilit√© **`protected`:** l'attribut est accessible seulement de l'int√©rieur de la classe dont-il est membre ainsi que de l'int√©rieur des classes fille qui h√©ritent de cette classe.

  ```php
  class Vehicule
  {
      private $vitesse = 120;
      protected $carburant = 'diesel';
  }

  class Voiture extends Vehicule
  {
      # methods, getters & setters
  }

  $mercedes = new Voiture();

  var_dump([
      'carburant' => $mercedes->getCarburant()
      'vitesse' => $mercedes->getVitesse()
  ]);
  # PHP Warning:  Undefined property: Voiture::$vitesse
  ```

  La methode `getVitesse` va avoir une valeur `null` car elle n'a pas acces√† la propri√©t√© `$vitesse` qui est d√©fini en `private`.
  
  Elle ne peut donc pas etre accessible hors de la classe `Voiture` contraiement √† la propri√©t√© `$carburant`.
]
---


.left-column[
  ## H√©ritage
  ### Mot cl√© extends
  ### Visibilit√© protected
]
.right-column[
  D√©pla√ßons maintenant les propri√©t√©s, constantes, constructeur et m√©thodes vers la classe `Vehicule`. Ainsi nous pourront voir comment nous les utiliser dans les classes filles `Voiture` et `Camion`.

  ```php
  class Vehicule
  {
    const NB_ROUES = 4;
    protected $vitesse = 100;
    protected $carburant = 'diesel';
    public static $nbPortes = 5;

    public function __construct($vitesse, $carburant)
    {
      $this->vitesse = $vitesse;
      $this->carburant = $carburant;
    }

    public function rouler() { ... }
    public static function ajouterPortes() { ... }
  }

  class Voiture extends Vehicule { }
  class Camion extends Vehicule { }
  ```
]

---

.left-column[
  ## H√©ritage
  ### Mot cl√© extends
  ### Visibilit√© protected
]
.right-column[
  **Instanciation et utilisation :**

  ```php
  $suziki = new Vehicule(120, 'diesel');
  $volvoTruck = new Camion(150, 'essence');
  $mercedes = new Voiture(90, 'ethanol');

  $suziki->rouler();
  $volvoTruck->rouler();
  $mercedes->rouler();

  var_dump(compact('mercedes', 'volvoTruck', 'suziki'));
  ```

  Lorsqu‚Äôune **classe fille h√©rite d‚Äôune classe m√®re**, elle peut acc√©der et utiliser tous les membres non priv√©s de la classe m√®re. Nous le savons, mais est-ce qu'une classe fille peut avoir ses propres propri√©t√©s et m√©thodes ? Oui, elle peut en avoir.

  ```php
  class Vehicule { ... }

  class Voiture extends Vehicule
  {
    public function conduire()
    {
      return 'Bonne conduite √† '.$this->vitesse.' Km/h  ...';
    }
  }

  $volvoTruck = new Camion(150, 'essence');
  $mercedes = new Voiture(90, 'ethanol');
  var_dump($mercedes->conduire());
  var_dump($volvoTruck->conduire());
  # PHP Fatal error:  Uncaught Error: Call to undefined method Camion::conduire()
   ```
]

---

.left-column[
  ## H√©ritage
  ### Mot cl√© extends
  ### Visibilit√© protected
  ### Mot cl√© Final
]
.right-column[
  Le mot-cl√© **`final`** emp√™che les classes enfants de surcharger une m√©thode en pr√©fixant la d√©finition avec final. Si la classe elle-m√™me est d√©finie comme **`final`**, elle ne pourra pas √™tre √©tendue.

  Cela peut √™tre utile si vous souhaitez emp√™cher explicitement certains d√©veloppeurs de surcharger certaines m√©thodes ou d‚Äô√©tendre certaines classes dans le cas d‚Äôun projet Open Source par exemple.

  ```php
  class Vehicule 
  { 
    final public function rouler() { ... }
  }

  final class Voiture extends Vehicule
  {

  }

  ```
  * La methode `Vehicule::rouler()` ne pourra pas etre redefini par les classes enfants

  * La classe `Voiture` ne pourra pas √©tendre √† d'autres classes
]
---

.left-column[
  ## H√©ritage
  ### Mot cl√© extends
  ### Visibilit√© protected
  ### Mot cl√© Final
  ### Trait
]
.right-column[
  PHP ne supporte que l‚Äôh√©ritage simple, c‚Äôest √† dire, une classe fille ne peut h√©riter que d‚Äôune seul classe m√®re. Donc, que faire si une classe a besoin d‚Äôh√©riter de plusieurs classes m√®res ? Les **traits** r√©solvent ce probl√®me.

  Les **traits** sont utilis√©s pour d√©clarer les m√©thodes qui peuvent √™tre utilis√©es dans plusieurs classes. Les **traits** peuvent avoir des propri√©t√©s, m√©thodes simple et abstraites qui peuvent √™tre utilis√©es dans plusieurs classes, et les m√©thodes peuvent avoir n‚Äôimporte quel modificateur d‚Äôacc√®s (`public`, `private`, or `protected`).

  Les traits sont d√©clar√©s avec le mot-cl√© **`trait`** :

  ```php
  trait VitesseTrait
  {
    protected $vitesse = 120;

    public function setVitesse($vitesse)
    {
      $this->vitesse = $vitesse;
    }

    public function getVitesse()
    {
      return $this->vitesse;
    }
  }
  ```
]

---

.left-column[
  ## H√©ritage
  ### Mot cl√© extends
  ### Visibilit√© protected
  ### Mot cl√© Final
  ### Trait
]
.right-column[
  **Utilisation de trait dans une classe**

  ```php
  class Vehicule
  {
    use vitesseTrait;
    ...
  }

  $vehicule = new Vehicule();
  $vehicule->setVitesse(170);
  ```

  Si d‚Äôautres classes ont besoin d‚Äôutiliser la propri√©t√© **`vitesse`** et ses **accesseurs**, utilisez simplement le trait ¬´ `VitesseTrait` ¬ª dans ces classes. Cela r√©duit la duplication du code, car il n‚Äôest pas n√©cessaire de d√©clarer √† nouveau la m√™me propri√©t√© et m√©thodes encore et encore.

  Un trait peut aussi inclure d'autres traits.
  ```php
  trait PropVitesseTrait { 
    protected $vitesse = 120;

    abstract public function setVitesse($vitesse); 
  }

  trait VitesseTrait {
    use PropVitesseTrait;

    public function setVitesse($vitesse) { ... }
    public function getVitesse() { ... }
  }
  ```
]

---

.left-column[
  ## H√©ritage
  ### Mot cl√© extends
  ### Visibilit√© protected
  ### Mot cl√© Final
  ### Trait
  ### .red[**üèó T. P.**]
]
.right-column[
Continuons √† am√©liorer l'outils de gestion de la **soci√©t√© R**. En effet elle souhaiterai maintenant g√©rer **les responsables**. 

**Le responsable** est un employ√© mais avec des privil√®ges.

- Ajouter une nouvelle classe `Responsable` qui √©tendra de `Employe`.

  - Faire en sorte qu'on ne puisse plus √©tendre de la classe `Responsable`
  - Cette nouvelle classe aura comme nouvelle propri√©t√© `equipe` qui sera de type classe `Equipe`.
  - Ajouter √† la classe `Equipe` une propri√©t√© `responsable`
  - Faire en sorte dans le mutateur de la propri√©t√© `Equipe.responsable` d'affecter au responsable l'equipe actuel.
  - Ajouter deux nouveaux reponsables √† affecter dans les deux √©quipes.

- Ajouter des traits pour le code qui est dupliqu√©.

- Ajouter une methode `supressionEmploye` √† la classe `Equipe` qui s'occupera de supprimer un employ√© de la liste via son `id`

**Note :** Il est possible depuis PHP5 de typer les variable de type classe comme ce qui suit

```php
public function test(ClassName $var) { ... }
```
]

---

class: middle, center, inverse
# 4. Plus de contr√¥le

---

.left-column[
### Interfaces
#### D√©claration
]
.right-column[
  **Une interface** permet aux utilisateurs de cr√©er des programmes, en sp√©cifiant les m√©thodes publiques qu‚Äôune classe doit impl√©menter, sans impliquer la complexit√© et les d√©tails de l‚Äôimpl√©mentation des m√©thodes. 
  
  .small[
    üíÅ En clair une interface permet de sp√©cifier un contrat qu'une classe doit impl√©menter.
  ]
  
  Une interface est d√©finie comme une classe, mais avec le mot-cl√© **`interface`**.

  ```php
  interface RoulerInterface
  {
    const NB_ROUES = 4;
    public function rouler();
  }
  ```

  - L‚Äôinterface **ne contient pas de propri√©t√©s ou de variables** comme le cas dans une classe.
  - Les interfaces **peuvent contenir des constantes.** Les constantes d'interfaces fonctionnent exactement comme les constantes de classe.
  - Une interface **se compose de m√©thodes qui ne contiennent aucune impl√©mentation.** En d'autres termes, toutes les m√©thodes de l'interface sont des m√©thodes abstraites.
  - Les interfaces ne peuvent pas √™tre instanci√©s, ni d√©finir des m√©thodes priv√©es ou prot√©g√©es pour une classe et ne peut d√©finir les propri√©t√©s d'une classe.


  .small[
    üö® Notez que toutes les m√©thodes de l'interface doivent √™tre publiques.
  ]
]

---

.left-column[
  ### Interfaces
  #### D√©claration
  #### Implementation
]
.right-column[

Pour impl√©menter une interface, l'op√©rateur `implements` est utilis√©. Lorsqu'une classe impl√©mente une interface, elle doit implementer toutes les m√©thodes de l'interface.

  ```php
  class Vehicule implements RoulerInterface
  {
    # codes 

    final public function rouler()
    {
        return 'Voiture '.$this->carburant.', roulant √† '.$this->vitesse.' KM/h avec '.
        self::NB_ROUES.' roues';
    }
  }
  ```

  La classe impl√©mentant l'interface doit d√©clarer toutes les m√©thodes dans l'interface avec une signature compatible.
]

---

.left-column[
  ### Interfaces
  #### D√©claration
  #### Implementation
  #### Implementation multiple
]
.right-column[
  Une classe ne peut h√©riter que d'une seule classe. Cependant, elle peut impl√©menter plusieurs interfaces, en s√©parant chaque interface par une virgule.

  ```php
  interface PorteInterface
  {
    public static function getNbPortes();

  }

  class Vehicule implements RoulerInterface, PorteInterface
  { 
    # codes

    final public function rouler()
    {
        return 'Voiture '.$this->carburant.', roulant √† '.$this->vitesse.' KM/h avec '.
        self::NB_ROUES.' roues';
    }

    public static function getNbPortes() 
    {
        return self::$nbPortes;
    }
  }
  ```

  Ainsi la classe `Vehicule` doit implementer les deux contrats.
]

---

.left-column[
  ### Interfaces
  #### D√©claration
  #### Implementation
  #### Implementation multiple
  #### H√©ritage, avantage
]
.right-column[
  Comme une classe , une interface peut √©tendre d'autres interfaces en utilisant le mot-cl√© `extends`. 
  
  L'exemple suivant montre comment `VehiculeInterface` etend de `PorteInterface`, `RoulerInterface`
  ```php
  interface VehiculeInterface extends PorteInterface, RoulerInterface
  {

  }
  ```

  #### Pourquoi utiliser les interfaces PHP ?
Voici les raisons d'utiliser les interfaces :

- En impl√©mentant une interface, l'appelant de l'objet doit se soucier uniquement de l'interface de l'objet, pas des impl√©mentations des m√©thodes de l'objet. Par cons√©quent, vous pouvez modifier les impl√©mentations sans affecter l'appelant de l'interface.
- Une interface permet √† des classes non li√©es d'impl√©menter le m√™me ensemble de m√©thodes, quelle que soit leur position dans la hi√©rarchie d'h√©ritage de classe.
- Une interface vous permet de mod√©liser plusieurs h√©ritages car une classe peut impl√©menter plusieurs interfaces.
]

---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
]
.right-column[
Dans le projet de la soci√©t√© R pour avoir plus de controle sur le code et les classes, nous allons utiliser les interfaces.

  - Ajouter une interface pour les classes
   - `Employe` avec ses m√©thodes accesseurs et `presentation()`

   - `Responsable` avec ses m√©thodes accesseurs (h√©ritage compris)
   
   - `Equipe` avec ses m√©thodes accesseurs, `travailler()`, `percent()` et `getNbHeuresTravails` .

  - Deplacer les constantes aux niveaux des interfaces. 
  - Ajouter les constantes `AGE_MIN`, `AGE_MAX`, `ANCIENNETE_MIN`, `ANCIENNETE_MAX` puis les utiliser.

  - D√©placer les fichiers de type :
    - `interface` dans un nouveau r√©pertoire `Interface`.

    - `trait` dans un nouveau r√©pertoire `Traits`.

    - `class` dans un nouveau r√©pertoire `Model`.
]

---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  #### D√©claration
]
.right-column[
  **Les classes abstraites** sont tr√®s similaires aux interfaces. Ils ne sont pas con√ßus pour **√™tre instanci√©s seuls** et fournissent une impl√©mentation de base √† partir de laquelle vous pouvez vous √©tendre.
  
  Toute classe contenant au moins une m√©thode abstraite doit elle-aussi √™tre abstraite. **Les m√©thodes d√©finies comme abstraites** d√©clarent simplement la signature de la m√©thode ; elles ne peuvent d√©finir son impl√©mentation.

  Lors de l'h√©ritage d'une classe abstraite, toutes les m√©thodes marqu√©es comme abstraites dans la d√©claration de la classe parente doivent √™tre d√©finies par la classe enfant et suivre les r√®gles habituelles d'[h√©ritage](https://www.php.net/manual/fr/language.oop5.inheritance.php) et de [compatibilit√© de signature](https://www.php.net/manual/fr/language.oop5.basic.php#language.oop.lsp).

  ```php
  abstract class AbstractVehicule
  {
    use VitesseTrait;

    private $dimensions;
    protected $carburant;

    abstract public function rouler();
    public function getDimensions() 
    {
      return $this->dimensions;
    }
  }
  ```

  La classe `AbstractVehicule` est abstraite, ce qui signifie que nous ne pouvons pas l'instancier directement. Pour pouvoir l'utiliser, il faudrait en h√©riter.
]

---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  #### D√©claration
  #### H√©ritage
]
.right-column[
  #### H√©ritage de la classe abstraite

  ```php
  class Voiture extends AbstractVehicule implements VehiculeInterface
  {
    private $dimensions = 90; // !== AbstractVehicule::$vitesse
    protected $carburant = 'diesel';

    public function rouler()
    {
      echo 'Voiture '.$this->carburant.', roulant √† '.$this->vitesse.' KM/h avec '.
      self::NB_ROUES.' roues';
    }
  }
  ```

  Vous avez peut-√™tre remarqu√© que dans la classe `AbstractVehicule` que nous avons d√©clar√©e, a une m√©thode **publique abstraite** appel√©e `rouler()`. 
  
  Cela nous permet essentiellement de d√©finir la signature d'une m√©thode qu'une classe enfant doit inclure de la m√™me mani√®re que nous le ferions avec une interface. 
  
  C'est tr√®s pratique si vous souhaitez partager certaines fonctionnalit√©s avec vos classes enfants, mais aussi imposer qu'elles incluent leurs propres impl√©mentations de certaines m√©thodes.
]

---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  ### Abstract Vs Interface
]
.right-column[
  | Classe d'interface | Classe abstraite |
|-----|------|
| ‚úÖ Prend en charge la fonctionnalit√© d'h√©ritage multiple | ‚ùå Prend pas en charge les h√©ritages multiples.|
| ‚ùå Ne contient pas de propri√©t√©s | La classe abstraite contient un membre de donn√©es.|
| L'interface n'autorise pas les constructeurs. | La classe abstraite prend en charge les constructeurs. |
| ‚ùå Ne contient que des m√©thodes abstraites qui font r√©f√©rence √† la signature du membre. | ‚úÖ Contient √† la fois des methodes abstraits et completes. |
| Puisque tout est suppos√© √™tre public, une classe d'interface n'a pas de modificateurs d'acc√®s par d√©faut.  | Une classe abstraite peut contenir des modificateurs d'acc√®s dans des sous-titres, des fonctions et des propri√©t√©s. |
| Tout membre d'une interface ne peut pas √™tre statique. | Seul un membre complet de la classe abstraite peut √™tre statique. |
]

---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  ### Abstract Vs Interface
  ### .red[**üèó T. P.**]
]
.right-column[
  Pour mieux assimiler l'abstraction nous allons concevoir un programme a partir de module UML suivant:

  [![](https://mermaid.ink/img/pako:eNq1k8FuwyAMhl8FsUunJlK7Y7Ttsm7nabsiVS64KVIClQNSoy7vPkKSNk2m3sYJff7Bv7E5c2kV8ozLAqpqoyEnKIURhoUVGfu02rinDTt3sF0pC4id2AtbTWF9C5dsZ32OtGhj6pREjaofx4rt1tlvR9rki543g4MPSyWy5580ZV8oHZi8wFnkDUneYsFXiRGcpelr2K-Tddj3ZYxlGXuIfrSa0qFmicYR3kaX8UzlwGnJpC2PDj1dq46yVgW7yhHIIPW0B4lDcXPBEUmXGBLNJPceb9yjy-NcmtRVVgDlwd0EWpP71vOA_2pBSyfGWzSz2szNdP24zks3GAS1Nf-VEYhGCe-O1OWp-uGJR-PiCS-RStAq_Id4meDugCUKnoWtwj34wgkuTBOk_qjA4bvSzhLP9lBUmHDwIW9tJM8ceRxE_bfqVc0vHHwHTw)](https://mermaid.live/edit#pako:eNq1k8FuwyAMhl8FsUunJlK7Y7Ttsm7nabsiVS64KVIClQNSoy7vPkKSNk2m3sYJff7Bv7E5c2kV8ozLAqpqoyEnKIURhoUVGfu02rinDTt3sF0pC4id2AtbTWF9C5dsZ32OtGhj6pREjaofx4rt1tlvR9rki543g4MPSyWy5580ZV8oHZi8wFnkDUneYsFXiRGcpelr2K-Tddj3ZYxlGXuIfrSa0qFmicYR3kaX8UzlwGnJpC2PDj1dq46yVgW7yhHIIPW0B4lDcXPBEUmXGBLNJPceb9yjy-NcmtRVVgDlwd0EWpP71vOA_2pBSyfGWzSz2szNdP24zks3GAS1Nf-VEYhGCe-O1OWp-uGJR-PiCS-RStAq_Id4meDugCUKnoWtwj34wgkuTBOk_qjA4bvSzhLP9lBUmHDwIW9tJM8ceRxE_bfqVc0vHHwHTw)
]


---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  ### Abstract Vs Interface
  ### .red[**üèó T. P.**]
]
.right-column[
1. D√©finir chaque classe, puis les propri√©t√©, ensuite les accesseurs, mutateurs et les constrcuteurs.

2. La fonction magique **`Point2D::__toString`** permet d‚Äôafficher les propri√©t√©s sous la forme : **"Point(x =10,y =3)"**

3. La m√©thode **`Point2D::bouger`** prenant en param√®tre les deux entiers `dx` et `dy` et qui permet de translater le point vers le point  `x + dx` ,`y + dy`.

4. Lors de l'instanciation d‚Äôune Forme, son id est incr√©ment√© selon le nombre de Formes instanci√©s.

5. D√©finir la m√©thode **`Rectangle::surface`** qui renvoie la surface d‚Äôun objet rectangle : **largeur x longueur**.

6. D√©finir la m√©thode **`Rectangle::perimetre`** qui renvoie le p√©rim√®tre d‚Äôun objet rectangle : **2 x (largeur + longueur)**.

7. D√©finir la m√©thode **`Cercle::surface`** qui renvoie la surface d‚Äôun objet cercle : **œÄ x r¬≤**

8. D√©finir la m√©thode **`Cercle::perimetre`** qui renvoie le p√©rim√®tre d‚Äôun objet rectangle : **2 x œÄ x r**

9. Chaque methode __toString affichera `{ NomClasse: id, ... liste des propri√©t√©s }` 
  
  _**Exemple :**_ `{ Rectangle: 1, Centre: Point(x=2, y=3), Largeur: 1, Longueur: 2, surface: 2, perimetre: 6 }`
10. Instancier 3 formes : cercle(x=1, y=3, rayon=2), rectangle(x=2, y=3, longueur=3, largeur=2), carre(x=4, y=6, longueur=3)

11. Appliquer une d√©placement du cercle par (dx=2,dy=1), rectangle (dx=3, dy=4), carre (dx=1, y=5)

]
---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  ### Abstract Vs Interface
  ### .red[**üèó T. P.**]
  ### Polymorphisme
  #### Qu'est-ce que c'est ?
]
.right-column[
  **Le polymorphisme** est un outil puissant et fondamental dans la programmation orient√©e objet. Il d√©crit un mod√®le dans lequel **les classes ont des fonctionnalit√©s diff√©rentes tout en partageant une interface commune.**

  La beaut√© du polymorphisme r√©side dans le fait que le code travaillant avec les diff√©rentes classes n'a **pas besoin de savoir quelle classe il utilise**, car elles sont toutes utilis√©es de la m√™me mani√®re.

  Dans le monde de la programmation, le polymorphisme est utilis√© pour rendre les applications plus modulaires et extensibles. 
  
  Au lieu d'instructions conditionnelles compliqu√©es d√©crivant diff√©rents plans d'action, vous cr√©ez des objets interchangeables que vous s√©lectionnez en fonction de vos besoins. C'est l'objectif de base du polymorphisme.
]

---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  ### Abstract Vs Interface
  ### .red[**üèó T. P.**]
  ### Polymorphisme
  #### Qu'est-ce que c'est ?
  #### Exemple
]
.right-column[
```php
interface TransportInterface {
  public function voyager(Voyageur $voyageur);
}

class Voiture implements TransportInterface {
  public function voyager(Voyageur $voyageur) {
    return $voyageur->getNom().' voyage en voiture' ;
  }
}

class Avion implements TransportInterface {
  public function voyager(Voyageur $voyageur) {
    return $voyageur->getNom().' voyage en avion' ;
  }
}

class Voyageur {
  private $nom;
  public function __construct($nom){
      $this->nom = $nom;
  }

  public function getNom(){
      return $this->nom;
  }

  public function voyager(TransportInterface $transport){
      return $transport->voyager($this);
  }
}
```
]

---
.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  ### Abstract Vs Interface
  ### .red[**üèó T. P.**]
  ### Polymorphisme
  #### Qu'est-ce que c'est ?
  #### Exemple
]
.right-column[
```php
# cours/index.php

$dany = new Voyageur('Daniel');

$voiture = new Voiture();
var_dump($dany->voyager($voiture));
# string(24) "Daniel voyage en voiture"

$avion = new Avion();
var_dump($dany->voyager($avion));
# string(22) "Daniel voyage en avion"
```

Cet exemple illustre bien le concept de polymorphisme via les interfaces. 

üôã Un voyageur (`$dany`) √† la choix entre deux transport : voiture üöô ou avion üõ´. 

‚Üí Quel que soit le transport, l‚Äôaction sera appel√©e par la m√™me m√©thode : dans notre cas, `voyager()`. 

üìå La m√©thode ne se soucie pas des d√©tails de chaque voyage. En effet chaque type de transport devient une classe qui d√©finit les donn√©es de du voyage. 

On pourra ainsi ajouter autant de type de transport que l'on souhaite si l'interface `TransportInterface` y est implement√©.
]

---

.left-column[
  ### Interfaces
  ### .red[**üèó T. P.**]
  ### Abstraction
  ### Abstract Vs Interface
  ### .red[**üèó T. P.**]
  ### Polymorphisme
  ### .red[**üèó T. P.**]
]
.right-column[
**La soci√©t√© R** pense √† l'√©ducation des jeunes et souhaite mettre en place la gestion des stagiaires.

Ainsi les enfants stagiaire ne seront pas consider√© comme des employ√©ss mais pourront tout de meme travailler.

- Ajoutons une nouvelle classe **`Stagiaire`** qui n'etendra pas de la classe **`Employe`**

  - Le stagiaire aura un id, nom, prenom, age (entre 12 et 18 ans) (Vous pouvez utiliser les traits)

- Ajouter un interface **`TravailleurInterface`** qui aura une fonction `travailler()` qui retournera un entier representant le nombre d'heures travaill√©s.

- Implementer cette interface aux classes `Employe` et `Stagiaire`. Un stagiaire travail entre 5 et 7 heures et un employ√© entre 6 et 9.

- D√©finir une m√©thode `faireTravailler` √† la classe `Responsable` qui pourra faire travailler un objet qui implemente `TravailleurInterface`.

- Une √©quipe aura dorenavant des `travailleurs` au lieu d'`employes`.
 
- Modifier la methode `Equipe::travailler` pour demander au responsable de faire travailler les membres de son √©quipe.

- Un Stagiaire fera parti d'une √©quipe. Ajouter donc 5 nouveaux stagiaires repartie dans les deux √©quipe.

- Faire en sorte que chaque responsable d'√©quipe fasse travailler son √©quipe.
]

---

.left-column[
  ### Namespace
]
.right-column[
Dans ce tutoriel nous allons apprendre les espaces de noms en PHP. En PHP, lorsque nous cr√©ons de grandes applications ou lorsque nous int√©grons des applications/biblioth√®ques tierces, il peut y avoir des risques de conflits entre les noms de classes, les noms de fonctions. Donc pour √©viter ces probl√®mes, les ¬´ espaces de noms ¬ª en PHP fournissent un moyen de regrouper les classes, interfaces, fonctions et constantes.

Pour d√©finir un namespace, rien de plus simple. On va utiliser le mot cl√© `namespace` juste avant la d√©finition de la classe :

```php
# Interfaces/Vehicule.php
namespace Interfaces;
interface Vehicule {}

# Classes/Vehicule.php
require 'Interfaces/Vehicule.php';
namespace Classes;
use Interfaces\Vehicule as VehiculeInterface;
class Vehicule implements VehiculeInterface {}
```

L‚Äôespace de noms est utilis√© pour √©viter des conflits et introduire plus de flexibilit√© et d‚Äôorganisation dans le code. Tout comme les r√©pertoires, l‚Äôespace de noms peut contenir une hi√©rarchie connue sous le nom de sous-espaces. PHP utilise la barre oblique inverse ¬´ `\` ¬ª comme s√©parateur d‚Äôespace de noms.
]
---

.left-column[
  ### Namespace
]
.right-column[
**Conclusion**

- Un espace de noms peut √™tre consid√©r√© comme un concept abstrait. Il permet de red√©clarer les m√™mes fonctions/classes/interfaces dans un espace de noms s√©par√© sans obtenir l‚Äôerreur fatale.

- Un espace de noms est un bloc de code hi√©rarchiquement √©tiquet√© contenant un code PHP r√©gulier.

- Un espace de noms peut contenir du code PHP valide.

- Un espace de noms concerne les types de code suivants : classes (y compris les classes abstraits et les traits), interfaces, fonctions et constantes.

- Les espaces de noms sont d√©clar√©s en utilisant le mot-cl√© **`namespace`**.
]
---

.left-column[
  ### Namespace
  ### .red[**üèó T. P.**]
]
.right-column[
- Ajouter un r√©pertoires `Classes/`, `Traits/`, `Abstracts/` et `Interfaces/` pour stocker nos diff√©rentes classes.

- R√©organiser les classes, traits, abstracts et interfaces dans les dossiers respectifs  

- Pour chaque fichier, y d√©finir les namespace 

  - **`namespace Classes;`**

  - **`namespace Interfaces`**

  - **`namespace Traits`**

  - **`namespace Abstracts`**

- Faire une `require_once` de chaque fichier dans `index.php`

- Utiliser le mot cl√© `use` pour resoudre les erreurs de classe indefini dans chaque fichier
]

---

.left-column[
  ### Namespace
  ### .red[**üèó T. P.**]
  ### Les exceptions
]
.right-column[
  PHP a introduit une nouvelle fa√ßon de g√©rer la plupart des erreurs en utilisant ce qu‚Äôon appelle les **exceptions**. Cette nouvelle fa√ßon de proc√©der se base sur le PHP orient√© objet et sur la classe **`\Exception`**.

  L‚Äôid√©e ici va √™tre de cr√©er ou de **¬´ lancer (`throw`)¬ª** un nouvel objet `\Exception` lorsqu‚Äôune erreur sp√©cifique est d√©tect√©e. D√®s qu‚Äôune exception est lanc√©e, le script va suspendre son ex√©cution et le PHP va chercher un endroit dans le script o√π l‚Äôexception va √™tre **¬´ attrap√©e (`catch`) ¬ª.**

  Utiliser des exceptions va nous permettre de g√©rer les erreurs de mani√®re plus fluide et de personnaliser la fa√ßon dont un script doit g√©rer certaines erreurs.

  Notez que quasiment tous les langages serveurs utilisent le concept d‚Äôexceptions pour prendre en charge les erreurs car c‚Äôest la meilleure fa√ßon de proc√©der √† ce jour.

  #### Comment utiliser les excepetions

  Une exception peut √™tre lanc√©e `throw` et attrap√©e `catch` dans PHP. Le code devra √™tre entour√© d'un bloc `try` pour faciliter la saisie d'une exception potentielle.
]
---

.left-column[
  ### Namespace
  ### .red[**üèó T. P.**]
  ### Les exceptions
]
.right-column[
On va ameliorer l'accesseur `setCarburant` de notre classe `Vehicule`, en utilisant la gestions des erreurs via les exceptions.

```php
class Voiture
{
  ...

  public function setCarburant($carburant)
  {
    if(!in_array($carburant, ['diesel', 'essence', 'ethanol'])) {
      throw new \Exception("La voiture ne supporte pas le carburant ".$carbrant, 1);
    }

    $this->carburant = $carburant;
  }
}

try {
  $voiture = new Voiture();
  $voiture->setCarburant('eau');
} catch (\Exception $e) {
  echo 'Message d\'erreur : ' .$e->getMessage();
  echo 'Code d\'erreur : ' .$e->getCode();
  echo $e->getFile();
}
```

L‚Äôid√©e derri√®re les exceptions va √™tre d‚Äôanticiper les situations probl√©matiques (situations qui vont pouvoir causer une erreur) et de lancer une exception si la situation est rencontr√©e.
]

---

.left-column[
  ### Namespace
  ### .red[**üèó T. P.**]
  ### Les exceptions
  ### .red[**üèó T. P.**]
]
.right-column[
  Nous allons appliquer la gestion d'erreur sur notre application de la soci√©t√© R.
  1. Ajouter une nouveau repertoire `Exceptions`
  
  2. Y d√©finir une nouvelle classe `RException` dans le namespace `Exceptions`
  
  3. Dans la methode `Employe::setAnciennete` gerer les cas de plus de 40 ans
  
  4. Dans la methode `Employe::setAge` gerer les cas des personnes n'entrant pas dans la tranche d'age de 18 - 65 ans.
  
  5. Utiliser un `try-catch` lors du set de l'age ou de l'ancienn√©t√© (present dans le constructeur)

  6. Dans la methode `Employe::incrementeEmploye` gerer par une exception lorsque le quota max est atteint
]

---

.left-column[
  ### Classe anonyme
]
.right-column[
Lors de la cr√©ation d'un nouvel objet, une classe est d'abord d√©finie, puis un objet de cette classe est cr√©√©. En PHP 7, une classe dite anonyme a √©t√© introduite pour permettre aux classes d'√™tre d√©finies sans nom √† la vol√©e.

On d√©finit une classe anonyme en utilisant le mot-cl√© `new class`.

```php
  $obj1 = new class() {};

  $obj2 = new class($x, $y) {
     private $x;
     private $y;
     public function __construct($x, $y) {
           $this->x = $x;
           $this->y = $y;
     }
  };
```

Elles peuvent prendre des arguments via le constructeur, h√©riter d‚Äôautres classes, impl√©menter des interfaces, et utiliser des traits comme dans une classe normale.

  ```php
    $classX = new class extends Avion implements Transport {
      use VitesseTrait;
    };

    $classX->setVitesse(120);
    var_dump($classX);
  ```
  
  Les objets instanci√©s par une classe anonyme ne sont pas diff√©rentes de celle des objets instanci√©s par une classe normale.
]

---

.left-column[
  ### Classe anonyme
  ### Methode anonyme
]
.right-column[
  **Les fonctions anonymes**, qu‚Äôon appelle √©galement **des closures**, sont des fonctions qui ne poss√®dent pas de nom.

```php
  $squ = function(float $x){
      return $x**2;
  };

  var_dump($squ(3));
  # int(9)
```
Lorsqu‚Äôon assigne une fonction anonyme en valeur de variable, notre variable va automatiquement devenir un objet de la classe pr√©d√©finie Closure.

Les classes anonymes vont √™tre utiles dans le cas ou des objets simples et uniques ont besoin d‚Äô√™tre cr√©√©s √† la vol√©e.

Cr√©er des classes anonymes va donc principalement nous faire gagner du temps et am√©liorer in-fine la clart√© de notre code.
]
---

.left-column[
  ### Classe anonyme
  ### Methode anonyme
  ### Reflection de classe
  #### Qu'est-ce que c'est ?
]
.right-column[
**La r√©flexion** dans le d√©veloppement logiciel est quelque chose qui est utilis√© assez souvent.

**La r√©flexion** est l'endroit o√π un objet est capable de s'examiner de mani√®re introspective pour vous informer de ses m√©thodes et propri√©t√©s au moment de l'ex√©cution.

√Ä premi√®re vue, cela ne semble pas √™tre quelque chose qui serait particuli√®rement utile. Cependant, `Reflection` est en fait un aspect vraiment int√©ressant du d√©veloppement logiciel et c'est quelque chose que vous aborderez probablement souvent.

L'une des fa√ßons les plus courantes d'utiliser Reflection consiste √† d√©boguer votre code. Vous avez probablement utilis√© les fonctions `get_class()` et `get_class_methods()` lorsque vous travaillez avec un objet dont le nom est ambigu. La possibilit√© d'obtenir le type ou les m√©thodes d'un objet lorsque vous ne savez pas de quel type d'objet il s'agit est la r√©flexion.

Une autre utilisation courante de `Reflection` est la cr√©ation de documentation. Il serait extr√™mement laborieux d'√©crire une documentation sur chaque m√©thode de chaque classe d'un grand framework ou d'une application. Au lieu de cela, `Reflection` peut g√©n√©rer automatiquement la documentation pour vous. Pour ce faire, il inspecte chaque m√©thode, constructeur et classe pour d√©terminer ce qui entre et ce qui sort.

Inspectons la classe `Voiture`.
```php

$mercedes = new Voiture(90, 'ethanol');
$reflection = new \ReflectionClass($mercedes);
```
]
---

.left-column[
  ### Classe anonyme
  ### Methode anonyme
  ### Reflection de classe
  #### Qu'est-ce que c'est ?
  #### Cas d'utilisation
]
.right-column[
#### Obtenir le nom de la classe
```php
var_dump($reflection->getName());
# App\Model\Voiture

var_dump($reflection->getShortName());
# Voiture

var_dump($reflection->getNamespaceName());
# App\Model
```

#### Obtenir la classe parent
```php
$parent = $reflection->getParentClass();
var_dump($parent->getName());
# App\Model\Vehicule
```

#### Obtenir les interfaces
```php
$interfaces = $reflection->getInterfaceNames();
var_dump(interfaces);
/* array(3) {
[0] => string(28) "App\Interfaces\VehiculeInterface"
[1] => string(26) "App\Interfaces\TransportInterface"
} */
```

d'autres possibilit√©s √† voir sur https://www.php.net/manual/fr/class.reflectionclass.php
]
---

class: middle, center, inverse

## 5. L'auto-chargement des classes

---

.left-column[
  ### L'autoloader
]
.right-column[
  Jusqu'ici, nous avons d√©fini les classes et nous les avons instanci√© pour nous servir des objets qui en sont les instances, et tout ceci dans la m√™me page PHP. Bien que √ßa marche, ce n'est cependant pas une m√©thode de travail propre et organis√©e.

  **On conseille donc toujours de s√©parer les classes dans diff√©rents fichiers. **

  Le probl√®me c'est que l'on est oblig√© ensuite de faire beaucoup de **`require`** pour charger nos diff√©rentes classes. Heureusement l'**autoloading** nous permet de rem√©dier √† ce probl√®me en incluant les classes d√®s que l'on en a besoin.

  Le principe de base est de cr√©er une fonction **`__autoload`** qui permettra √† PHP de savoir comment include nos classes.

  ```php
  function __autoload($className){
      require_once './' . str_replace('\\', '/', $className) . '.php';
  }
  ```

  Le probl√®me de cette m√©thode c'est qu'on ne peut pas avoir plusieurs fois la m√™me fonction et on ne peut donc pas cr√©er plusieurs autoloader.
]

---

.left-column[
  ### L'autoloader
]
.right-column[
  Heureusement, il est possible de cr√©er et d'enregistrer des fonctions manuellement en utilisant **`spl_autoload_register`**

  ```php
  # Autoloader.php
  class Autoloader
  {
    /** Enregistre notre autoloader */
    public static function register()
    {
        spl_autoload_register(array(__CLASS__, 'autoload'));
    }

    /**
     * Inclue le fichier correspondant √† notre classe
     * @param string $class Le nom de la classe √† charger
     */
    public static function autoload($className)
    {
        require_once str_replace('\\', '/', $className) . '.php';
    }
  }
  ```

  On utilise ici une classe avec des m√©thodes statique pour une meilleur organisation. On peut alors lancer notre autoloader simplement.

  ```php
  # index.php
  require 'Autoloader.php';
  Autoloader::register();
  ```
]


---

.left-column[
  ### L'autoloader
  ### Composer
  #### Gestionnaire de d√©pendence ?
]
.right-column[
  <img src="https://getcomposer.org/img/logo-composer-transparent5.png" height="100" style="display:block; margin: 0 auto">

  Composer est un outil mis en place pour la communaut√© des d√©veloppeurs de PHP. A l‚Äôimage de ¬´ `npm` ¬ª pour nodejs ou ¬´ `bundler` ¬ª pour ruby, il sert de gestionnaire de d√©pendance entre applications et librairies.

  **Qu'est-ce qu'un gestionnaire de d√©pendence ?**

  Le gestionnaire de d√©pendances est un outil qui peut √™tre utilis√© pour g√©rer les d√©pendances d‚Äôun projet. Le gestionnaire de d√©pendances est un excellent concept. C‚Äôest principalement un outil pour installer, d√©sinstaller et mettre √† jour ces d√©pendances. Grosso-modo, un ensemble de m√©canismes et permet √©galement la cr√©ation de packages (vos projets) qui peuvent √™tre distribu√©s. 

  De fa√ßon plus pr√©cise, Composer permet de g√©rer pour chaque projet, la liste des modules et biblioth√®ques n√©cessaires √† son fonctionnement ainsi que leurs versions. Il est utilisable via la console en ligne de commande. De plus, il permet de mettre en place un syst√®me d‚Äôautoload pour les biblioth√®ques compatibles.

  url : https://getcomposer.org/
]

---

.left-column[
  ### L'autoloader
  ### Composer
  #### Gestionnaire de d√©pendence ?
  #### Installation
]
.right-column[
### Installer composer

Vous pouvez installer composer sur n'importe quel syst√®me d'exploitation.

**Via curl**
```shell
curl -sS https://getcomposer.org/installer | php -- \
  --install-dir=/usr/local/bin \
  --filename=composer
```

**Via getcomposer.org**

Sinon vous pouvez aussi passer par la page de download de composer : https://getcomposer.org/download/

**Mettre √† jour composer**
```sh
composer self-update
# Upgrading to version 2.3.4 (stable channel).
   
# Use composer self-update --rollback to return to version 2.2.7
```
]

---

.left-column[
  ### L'autoloader
  ### Composer
  #### Gestionnaire de d√©pendence ?
  #### Installation
  #### Implementation
]
.right-column[

Pour initialiser `composer` dans un projet, c'est avec la commande suivante :
```bash
composer init
```

Cette commande, vous demande certaines informations concernant votre projet et g√©n√®re le r√©pertoire `vendor`, `src` et un fichier `composer.json` contenant les diff√©rentes configurations de notre projet. Vous pouvez ouvrir ce dernier et voir, c'est le m√™me contenu que vous venez de remplir.

```json
{
    "name": "formation/composer",
    "description": "test",
    "type": "project",
    "autoload": {
        "psr-4": {
            "Formation\\Composer\\": "src/"
        }
    },
    "authors": [
        {
            "name": "Fahari Hamada Sidi",
            "email": "mkl.devops@gmail.com"
        }
    ],
    "minimum-stability": "stable",
    "require": {}
}
```

C'est dans ce fichier que nous allons d√©finir nos d√©pendances et leurs diff√©rentes versions, voyons tout de suite donc comment ajouter une d√©pendance √† notre projet.
]

---

.left-column[
  ### L'autoloader
  ### Composer
  #### Gestionnaire de d√©pendence ?
  #### Installation
  #### Implementation
  #### Autoload
]
.right-column[

Nous avions precedement fait notre propre autoloader, mais composer peut en generer un aussi, qui comprendra tout aussi les namespaces des composant que l'on pourant installer.
Ajouter une section `autoload` au fichier `composer.json`
  ```json
  "autoload": {
        "psr-4": {
            "App\\": "src/"
        }
    },
  ```

  Apres avoir ajouter notre section d'autoload vers notre r√©pertoire `src`, g√©nerer le fichier autoload composer via la commande

  ```bash
  composer dump-autoload
  ```

  Inclure √† notre fichier index.php l'inclusion de l'autoloader gen√©r√© par composer
  ```php
    # index.php
    require_once 'vendor/autoload.php';

  ```
]

---

.left-column[
  ### L'autoloader
  ### Composer
  #### Gestionnaire de d√©pendence ?
  #### Installation
  #### Implementation
  #### Autoload
  #### Gestion de packages
]
.right-column[
  Le site https://packagist.org/ permet d‚Äôenregistrer vos propres packages mais aussi de chercher tous les packages disponible, avec une page compl√®te qui liste les diff√©rentes versions du packages.

  #### Installer une package

  ```bash
  composer require symfony/http-client symfony/var-dumper
  ```

  Apr√®s l‚Äôex√©cution de la commande, votre projet contiendra un nouveau fichier `composer.lock`

  #### Mettre √† jour les packages install√©s
  Vous devez savoir comment mettre √† jour vos paquets. Cela peut se faire de deux mani√®res :

  * **Mise √† jour universelle**. V√©rifie et installe les mises √† jour de tous vos paquets et d√©pendances en m√™me temps :
  ```bash
  composer update
  ```

  * **Mise √† jour sp√©cifique au paquet.** V√©rifier les mises √† jour d‚Äôun ou de plusieurs paquets sp√©cifiques :
  ```bash
  composer update symfony/http-client symfony/*
  ```


  #### Supprimer les packages install√©s
  ```bash
  composer remove symfony/http-client symfony/var-dumper
  ```
]
---

class: middle, center, inverse

## 6. Le typage de donn√©es

---

.left-column[
  ### PHP Doc
]
.right-column[
  C'est une transposition de Javadoc au langage PHP. Il s'agit d'un standard formalis√© pour commenter le code PHP. Il permet aussi √† certains IDE de conna√Ætre le type des variables et de lever d'autres ambigu√Øt√©s dues au typage faible, am√©liorant ainsi la compl√©tion de code

  ```php
  class Vehicule
  {
    ...

    /**
     * @var int Vitesse du v√©hicule
     */
    protected $vitesse = 100;

    /**
     * @param int $vitesse Vitesse du v√©hicule
     * @param string $carburant Carburant du v√©hicule
     */
    public function __construct($vitesse, $carburant)
    { ... }

    /**
     * @return int Vitesse du v√©hicule
   */
    public function getVitesse()
    { ...  }
    ...
  }
  ```
]
---

.left-column[
  ### PHP Doc
  ### Typage de donn√©es
  #### Pourquoi ?
]
.right-column[
  PHP est un langage typ√© dynamiquement. Lorsque vous d√©finissez une fonction , vous n'avez pas besoin de d√©clarer des types pour les param√®tres . Par example:

  ```php
  function add($x, $y) {
      return $x + $y;
  }

  var_dump(add(1,2)); # int(3)
  var_dump(add(1.0,2.3)); # int(3.3)
  var_dump(add(1.0,'3')); # int(4)

  var_dump(add('un','deux')); 
  # PHP Fatal error: Uncaught TypeError: Unsupported operand types: string + string
  ```

  Pour appliquer les types pour les param√®tres de fonction et la valeur de retour, vous pouvez utiliser des indications de type.
  ```php
  function add(int $x, int $y): int {
      return $x + $y;
  }

  var_dump(add(1,2)); # int(3)
  var_dump(add(1.0,2.3)); # int(3)
  var_dump(add(1.0,'3')); # int(4)

  var_dump(add('un','deux')); 
  # PHP Fatal error:  Uncaught TypeError: 
  # add(): Argument #1 ($x) must be of type int, string given
  ```
]
---

.left-column[
  ### PHP Doc
  ### Typage de donn√©es
  #### Pourquoi ?
  #### Utilisation
]
.right-column[
  Si vous souhaitez utiliser cette fonctionnalit√©, je vous conseille de **toujours activer** le **`declare(strict_types=1);`** dans chacun de vos fichiers `.php`.

  ```php
  declare(strict_types=1);

  class Vehicule
  {
    private ?int $vitesse = null;
    private ?string $carburant = null;
    public function rouler(?int $hour) : int
    {
      return $hour ? $hour * $vitesse : null;
    }
  }

  class Conducteur
  {
    private ?Vehicule $vehicule = null;
    public function __construct(Vehicule $vehicule)
    {
      $this->vehicule = $vehicule;
    }
  }
  ```
]

---

.left-column[
  ### PHP Doc
  ### Typage de donn√©es
  ### Type callable
]
.right-column[
```php
  $classX = new class extends Avion implements Transport {
    use VitesseTrait;
  };

  $classX->setVitesse(120);
  var_dump($classX);
```
]
---

.left-column[
  ### PHP Doc
  ### Typage de donn√©es
  ### Type callable
  ### Types d'Union
]
.right-column[
  Vous pouvez utiliser plusieurs types d'entr√©e pour la m√™me fonction au lieu d'un seul, ce qui permet un plus grand degr√© de r√©utilisation du code.
  ```php
  class Vehicule
  {
    private int|float|null $vitesse = null;

    public function setVitesse(int|float|null $vitesse) : self
    {
      $vitesse = $vitesse;
      return $this;
    }
  }
  ```

  Vous pouvez aussi utiliser des classes et interfaces d√©finies
  
  ```php
  class Conducteur 
  {
    public function conduire(Voiture|Camion $vehicule) 
    {
      ...
    }  
  }
  ```
]

---

.left-column[
  ### PHP Doc
  ### Typage de donn√©es
  ### Type callable
  ### Types d'Union
  ### Arguments nomm√©es
]
.right-column[
  **Les arguments nomm√©s** vous donnent plus de souplesse pour appeler les fonctions. Jusqu'√† pr√©sent, vous deviez appeler une fonction et passer chaque argument dans l'ordre sp√©cifi√© par la fonction.

  Un exemple d'utilisation avec la methode `number_format` : https://www.php.net/manual/en/function.number-format.php

  ```php
  // avec php 7.4, si je veux modifier le separateur des centaines
  number_format(1063, 0, ".", " ");
  ```

  Les arguments nomm√©s vous permettent de d√©finir un nom pour chaque param√®tre. Et maintenant, ils peuvent √™tre rappel√©s dans l'ordre ou le desordre, comme d√©crit ci-dessous : 
  ```php
  // En utilisant le nom des arguments
  number_format(num: 1063, decimals: 0, decimal_separator: ".", thousands_separator: " ");

  // En utilisant le nom des arguments sur ceux que modifi√©
  number_format(num: 1063, thousands_separator: " ");
  ```
]

---

.left-column[
  ### PHP Doc
  ### Typage de donn√©es
  ### Type callable
  ### Types d'Union
  ### Arguments nomm√©es
  ### .red[**üèó T. P.**]
]
.right-column[
### Implementer composer

Avec tous ce que l'on a appris et vu sur l'autoloader, composer et le typage de donn√©es, nous allons l'appliquer sur le projet de la soci√©t√© R.

- Installer composer et definir l'autoloader
- Deplacer les classes dans le repertoire `/src`
- Redefinir le bon namespace de chaque classe / interfaces, ... avec `App`
- Appliqu√© le typage le plus strict sur toute nos classes
- Installer le package `php-cs-fixer` via https://packagist.org/packages/friendsofphp/php-cs-fixer

```sh
# installer
composer require friendsofphp/php-cs-fixer --dev

# utiliser
./vendor/bin/php-cs-fixer fix --allow-risky=yes
```
- Installer le package `php-stan` via https://packagist.org/packages/phpstan/phpstan

```sh
# installer
composer require phpstan/phpstan --dev

# utiliser
./vendor/bin/phpstan analyse -l 9 src
```
]

---

class: middle, center, inverse

## PHP 8

PHP 8 a √©t√© officiellement mis √† la disposition du public le 26 novembre 2020 !

### Cette nouvelle mise √† jour majeure apporte tout un tas d‚Äôoptimisations et de puissantes fonctionnalit√©s au langage. Ce sont des changements tr√®s int√©ressants qui nous permettront d‚Äô√©crire un meilleur code et de construire des applications plus puissantes.

---

.left-column[
  ### Promotion de propri√©t√©s de constructeur
]
.right-column[
  Cette fonction devrait vous aider √† acc√©l√©rer votre processus de d√©veloppement et √† r√©duire les erreurs. En effet moins de code redondant pour d√©finir et initialiser les propri√©t√©s.

  ```php
  # with php 7.4
  class Vehicule 
  {
    private ?int $vitesse = 120,
    protected ?string $carburant = 'essence'

    public function __construct(?int $vitesse, ?string $carburant)
    {
      $this->vitesse = $vitesse;
      $this->carburant = $carburant;
    }
  }

  # with php 8
  class Vehicule 
  {
    public function __construct(
      private ?int $vitesse = 120,
      protected ?string $carburant = 'essence'
    ) { }
  }
  ```
]

---

.left-column[
  ### Promotion de propri√©t√©s de constructeur
  ### visibilit√© pour les constantes
]
.right-column[


  Depuis la version 7.1 de PHP, on peut d√©finir une visibilit√© pour nos constantes (public, protected ou private).

  Par d√©faut (si rien n‚Äôest pr√©cis√©), une constante sera consid√©r√©e comme publique et on pourra donc y acc√©der depuis l‚Äôint√©rieur et depuis l‚Äôext√©rieur de la classe dans laquelle elle a √©t√© d√©finie.

  ```php
  interface Vehicule
  {
    # accessible uniquement dans la classe/interface d√©clar√©
    private const CONST_PRIVATE = 'private';

    # accessible uniquement dans la classe/interface d√©clar√© et ceux qui h√©ritent
    protected const CONST_PROTECTED = 'protected';
    
    # Accessible de partout
    public const CONST_PUBLIC = 'public';
    
    # Accessible de partout
    const CONST_DEFAULT_PUBLIC = 'default_public';

    # Accessible de partout, mais ne peut etre redefini dans les classes qui h√©ritent
    final public const CONST_PUBLIC = 'public';
    
  }


  ```
]

---

.left-column[
  ### Promotion de propri√©t√©s de constructeur
  ### visibilit√© pour les constantes
  ### Fonction str_contains
]
.right-column[
  Cette nouvelle fonction plut√¥t sympathique renvoie une valeur bool√©enne (vrai/faux) si une cha√Æne est trouv√©e dans une autre cha√Æne. Il faut deux arguments, la cha√Æne de caract√®res √† rechercher et la cha√Æne de caract√®res √† rechercher.
  ```php
  str_contains('php8', '8'); // true

  str_contains('php8', 'wordpress'); // false
  ```

  Pour des filtres de cha√Ænes encore plus utiles, d√©couvrez ces nouvelles fonctionnalit√©s :

  ```php
  str_starts_with('haystack', 'hay'); // true

  str_ends_with('haystack', 'stack'); // true
  ```
]

---

.left-column[
  ### Promotion de propri√©t√©s de constructeur
  ### visibilit√© pour les constantes
  ### Fonction str_contains
  ### Null safe
]
.right-column[

  Dans l‚Äô√©valuation de null-safe `$a?->value`, le second op√©rateur n‚Äôest √©valu√© que si le premier op√©rateur n‚Äô√©value pas √† null. Si un op√©rateur d‚Äôune cha√Æne est √©valu√© √† null, l‚Äôex√©cution de la cha√Æne enti√®re s‚Äôarr√™te et est √©valu√©e √† null

**Exemple**
  ```php
  class Category {
    public __construct(public string $name) {}
  }

  class Vehicule
  {
    public ?Category $category = null;
  }

  $mercedes = new Voiture();
  var_dump($mercedes->category?->name); // affiche null

  $berline = new Category(name: 'Berline');
  $mercedes->category = $berline;
  var_dump($mercedes->category?->name); // affiche "Berline"
  ```
]

---

.left-column[
  ### Promotion de propri√©t√©s de constructeur
  ### visibilit√© pour les constantes
  ### Fonction str_contains
  ### Null safe
  ### √ânum√©rations
]
.right-column[
  Le support int√©gr√© pour les √©num√©rations est disponible depuis la version PHP 8.1
  ```php
  enum Status
  {
      case DRAFT;
      case PUBLISHED;
      case ARCHIVED;
  }
  ```
  L'avantage des √©num√©rations est qu'elles repr√©sentent une collection de valeurs constantes, mais surtout ces valeurs peuvent √™tre typ√©es, comme ceci.
  ```php
  class BlogPost
  {
      public function __construct(
          public Status $status, 
      ) {}
  }
  ```
  Dans cet exemple, la cr√©ation d'une √©num√©ration et sa transmission √† `BlogPost` ressemble √† ceci.

  ```php
  $post = new BlogPost(Status::DRAFT);
  ```

  Pour en savoir plus https://www.php.net/manual/fr/language.types.enumerations.php
]

---

.left-column[
  ### Promotion de propri√©t√©s de constructeur
  ### visibilit√© pour les constantes
  ### Fonction str_contains
  ### Null safe
  ### Enum
  ### Propri√©t√©s readonly
]
.right-column[
  PHP 8.1 prend en charge les propri√©t√©s de classe en lecture seule. Une propri√©t√© de classe d√©clar√©e en lecture seule ne peut √™tre initialis√©e qu'une seule fois, et d'autres modifications de la propri√©t√© ne sont pas autoris√©es.

  Les propri√©t√©s de classe en lecture seule sont d√©clar√©es avec le mot-cl√© `readonly` dans une propri√©t√© typ√©e .
  ```php
  class User 
  {
      public readonly int $uid;

      public function __construct(int $uid) 
      {
          $this->uid = $uid;
      }
  }

  $user = new User(42);
  $user->uid = 56; # Error: Cannot modify readonly property User::$uid in ...:...
  ```

  Les valeurs de propri√©t√©s en lecture seule ne peuvent √™tre d√©finies qu'√† partir de la classe elle-m√™me, soit √† partir du constructeur, soit d'une autre m√©thode. Une fois d√©finie, aucune autre modification n'est autoris√©e sur cette propri√©t√©, m√™me √† l'int√©rieur de la classe.
]

---

.left-column[
  ### Promotion de propri√©t√©s de constructeur
  ### visibilit√© pour les constantes
  ### Fonction str_contains
  ### Null safe
  ### Enum
  ### Propri√©t√©s readonly
  ### Les attributes
]
.right-column[
  L'un des plus grands changements de **PHP 8** est la prise en charge des attributs. Les attributs aident √† ajouter des m√©tadonn√©es aux fonctions, param√®tres, classes, m√©thodes de classe, constantes, propri√©t√©s, fermetures et m√™me aux classes anonymes PHP. 
  
  Ces m√©tadonn√©es peuvent √™tre r√©cup√©r√©es par programmation et fournissent une approche pragmatique pour r√©soudre les attributs ailleurs dans le code.

  #### Syntaxe et utilisation
  Les attributs sont d√©clar√©s avec `#[` et des `]`.
  ```php
  #[ExampleAttribute('foo', 'bar')]
  function example() {}
  ```

  Chaque attribut peut avoir z√©ro ou plusieurs param√®tres. Ils seront transmis au constructeur de la classe Attribute si vous tentez d'obtenir un objet instanci√© de l'attribut.
]

---

.left-column[
  ### .red[**Bilan Travaux Pratique**]
]
.right-column[
### TP commun

Avec tous ce que l'on a appris et vu, nous allons l'appliquer sur l'outils de la soci√©t√© R √† repartant de zero

- Recuperer le repo git
- Structure du projet
  - dossier `public`, `public/css`, `public/js` (tous nos fichiers public)
  - dossier `src` (Toutes nos classes)
  - fichier `public/index.php`
  - dossiers `pages`
- Base de donn√©es ou Fichier JSON
- Essayons ensemble de mettre en place
  - Un formulaire d'ajout d'employ√©
  - Un formulaire pour responsable
  - Une page qui liste tout les employ√©s
  - Page du responsable avec son √©quipe
]