name: inverse
class: center, middle, inverse
# Symfony Framework
# .red[PHP 8]
<div class="logo"><svg class="logo-1" fill="white" width="196" height="64" viewBox="0 0 196 64" style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2;"><g transform="matrix(0.101031,0,0,0.101031,2.39526,-0.329946)"><g transform="matrix(1.27705,0,0,1.27705,1143.65,155.404)"><path d="M320.958,94.576C320.958,107.301 317.357,117.884 310.155,126.323C302.952,134.763 293.386,140.971 281.456,144.947L331.695,223.685L290.072,223.685L246.727,150.647L230.025,150.647L230.025,223.685L193.837,223.685L193.837,40.361L247.787,40.361C296.568,40.361 320.958,58.433 320.958,94.576ZM283.312,94.576C283.312,84.855 280.462,77.764 274.762,73.301C269.062,68.838 260.38,66.607 248.715,66.607L230.025,66.607L230.025,124.931L249.908,124.931C260.954,124.931 269.283,122.501 274.895,117.641C280.506,112.78 283.312,105.092 283.312,94.576Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(1.27705,0,0,1.27705,1486.87,208.548)"><path d="M313.005,64.751L241.159,227.264L208.153,217.058L277.612,67.402L195.163,67.402L195.163,40.361L313.005,40.361L313.005,64.751Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(1.27705,0,0,1.27705,1335.53,155.404)"><path d="M253.752,12.524C257.994,12.524 261.75,13.43 265.019,15.241C268.289,17.053 270.852,19.55 272.708,22.731C274.563,25.912 275.491,29.447 275.491,33.335C275.491,37.224 274.563,40.758 272.708,43.94C270.852,47.121 268.289,49.64 265.019,51.495C261.75,53.351 257.994,54.279 253.752,54.279C249.51,54.279 245.733,53.351 242.419,51.495C239.105,49.64 236.52,47.121 234.664,43.94C232.808,40.758 231.88,37.224 231.88,33.335C231.88,29.447 232.808,25.912 234.664,22.731C236.52,19.55 239.105,17.053 242.419,15.241C245.733,13.43 249.51,12.524 253.752,12.524ZM201.658,83.309L276.419,83.309L276.419,198.897L313.402,198.897L313.402,223.685L200.332,223.685L200.332,198.897L241.424,198.897L241.424,108.097L201.658,108.097L201.658,83.309Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M261.043,177.319L211.622,177.319L211.622,218.681L254.382,218.681L254.382,228.302L211.622,228.302L211.622,271.803L264.332,271.803L264.332,280.93L201.096,280.93L201.096,167.944L262.441,167.944L261.043,177.319ZM213.76,150.758L245.501,134.23L250.682,143.851L216.72,156.432L213.76,150.758Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M312.861,273.201C321.248,273.201 329.06,270.651 336.297,265.553L341.642,272.46C337.969,275.53 333.501,277.984 328.238,279.82C322.975,281.657 317.987,282.575 313.272,282.575C304.994,282.575 297.922,280.766 292.056,277.148C286.191,273.529 281.723,268.376 278.653,261.688C275.583,255 274.048,247.133 274.048,238.088C274.048,229.426 275.583,221.696 278.653,214.898C281.723,208.101 286.218,202.756 292.139,198.863C298.059,194.971 305.131,193.025 313.354,193.025C323.935,193.025 333.282,196.287 341.395,202.81L335.968,210.129C328.128,204.757 320.426,202.07 312.861,202.07C307.488,202.07 302.733,203.441 298.594,206.182C294.455,208.923 291.22,212.993 288.89,218.393C286.561,223.793 285.396,230.358 285.396,238.088C285.396,245.927 286.547,252.465 288.849,257.7C291.152,262.935 294.373,266.828 298.512,269.377C302.65,271.926 307.434,273.201 312.861,273.201Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M386.388,193.025C394.118,193.025 400.641,194.834 405.959,198.452C411.277,202.07 415.251,207.224 417.883,213.912C420.514,220.6 421.83,228.549 421.83,237.759C421.83,246.421 420.473,254.137 417.759,260.907C415.046,267.677 411.003,272.981 405.63,276.819C400.258,280.656 393.761,282.575 386.141,282.575C378.412,282.575 371.874,280.725 366.529,277.024C361.184,273.324 357.168,268.13 354.482,261.441C351.796,254.753 350.453,246.914 350.453,237.923C350.453,228.987 351.81,221.148 354.523,214.405C357.237,207.662 361.294,202.413 366.694,198.658C372.093,194.903 378.658,193.025 386.388,193.025ZM386.388,201.988C369.887,201.988 361.636,213.967 361.636,237.923C361.636,261.661 369.805,273.529 386.141,273.529C402.478,273.529 410.646,261.606 410.646,237.759C410.646,213.912 402.56,201.988 386.388,201.988Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M463.945,261.359C463.945,265.635 465.301,268.76 468.015,270.734C470.729,272.707 474.443,273.694 479.157,273.694C483.982,273.694 489.053,272.652 494.37,270.569L497.33,278.463C494.973,279.669 492.136,280.656 488.82,281.424C485.503,282.191 481.953,282.575 478.171,282.575C473.566,282.575 469.413,281.739 465.713,280.067C462.012,278.395 459.093,275.955 456.955,272.748C454.817,269.541 453.748,265.745 453.748,261.359L453.748,168.52L426.94,168.52L426.94,159.639L463.945,159.639L463.945,261.359Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M520.121,241.87C520.231,248.833 521.491,254.657 523.904,259.345C526.316,264.032 529.509,267.513 533.483,269.788C537.458,272.063 541.885,273.201 546.764,273.201C551.15,273.201 555.11,272.57 558.646,271.309C562.182,270.048 565.979,268.02 570.035,265.224L575.38,272.872C571.433,275.942 566.952,278.326 561.936,280.026C556.919,281.725 551.999,282.575 547.175,282.575C539.336,282.575 532.552,280.725 526.823,277.024C521.094,273.324 516.722,268.102 513.707,261.359C510.692,254.616 509.184,246.777 509.184,237.841C509.184,229.125 510.705,221.381 513.748,214.611C516.791,207.84 521.08,202.55 526.617,198.74C532.154,194.93 538.486,193.025 545.613,193.025C552.52,193.025 558.496,194.711 563.539,198.082C568.583,201.454 572.434,206.278 575.093,212.555C577.751,218.832 579.081,226.246 579.081,234.798C579.081,236.059 578.999,238.417 578.834,241.87L520.121,241.87ZM545.859,202.564C541.09,202.564 536.855,203.674 533.155,205.894C529.454,208.114 526.48,211.472 524.232,215.967C521.985,220.463 520.669,226.027 520.285,232.66L569.377,232.66C569.158,222.793 566.938,215.31 562.717,210.211C558.496,205.113 552.876,202.564 545.859,202.564Z" style="fill-rule: nonzero;"></path></g><path d="M250.428,75.558C385.339,75.558 494.87,185.089 494.87,320C494.87,454.911 385.339,564.442 250.428,564.442C115.517,564.442 5.986,454.911 5.986,320C5.986,185.089 115.517,75.558 250.428,75.558ZM131.233,450.023L131.233,203.31L220.202,205.493C297.709,207.676 311.355,209.314 331.55,219.685C400.87,255.709 417.79,343.587 365.937,402.536L344.65,426.552L356.658,438.014L368.12,450.023L256.772,450.023L256.772,339.22L269.872,351.228L282.972,363.782L294.434,352.32C308.08,338.674 309.171,325.575 297.163,309.2C294.835,305.797 292.624,303.334 289.625,301.561C283.483,297.931 274.034,297.192 253.497,297.192L218.564,297.192L218.564,450.023L131.233,450.023Z"></path></g></svg></div>

---

class: middle
.left-column[
## Objectif
]
.right-column[

- Vous présenter le framework Symfony dans sa version 6. 

- Vous permettre d'apporter des solutions pertinantes aux projet.

- Vous permettre de repondre aux besoin de votre entreprise.

- Gagner en confiance et motivation

- Voir les bonnes pratiques developpement

- Travail en équipe et Pair programming
]

---

class: middle
.left-column[
## Objectif
## Au programme
]
.right-column[
- **Installation de notre environnement**
  - Docker
  - Un environement docker avec 
    - PHP 8.1
    - Composer
    - Node
    - Symfony cli

- **En route vers Symfony 6**
  - Nouveau projet symfony
  - Postgresql
  - Environnement de dev
  - Entité, Controller, Event
  - Messages
  - Redis
]

---
class: center, middle, inverse
# 1. Environnement de travail
---

.left-column[
## Installations
### Docker
]
.right-column[
* **Installation de docker sur Linux/Mac :** 
  * [engine ubuntu](https://https://docs.docker.com/engine/install/ubuntu/)
  * [deskstop mac](https://docs.docker.com/desktop/mac/install/)

* **Installation de docker desktop sur Windows** 
  * Télecharger [Windows Desktop](https://https://www.docker.com/products/docker-desktop)
  * Installer WSL (Ubuntu) via le store de Microsoft
  * Activer WSL 2 (Redemmarage necessaire)
  * Installer Windows terminal (facultatif)

Pour utiliser docker sans le mode `sudo` https://docs.docker.com/engine/install/linux-postinstall/
```sh
sudo groupadd docker

sudo usermod -aG docker $USER

newgrp docker 
```
]

---

.left-column[
## Installations
### Docker
### Docker-compose
]
.right-column[
Docker desktop `docker-compose` est installé par defaut.

#### Installation
Voir https://docs.docker.com/compose/install/

```sh
 curl -SL https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
 
 sudo chmod +x /usr/local/bin/docker-compose
```

Verifions que docker-compose est bien installé
```sh
 docker-compose --version

```
]

---

.left-column[
## Installations
### Docker
### Docker-compose
### Notre image PHP 8.1
#### Initialisation
]
.right-column[

Ajouter un nouveau repertoire de travail que nous nommeront `guestbook`.

```bash
mkdir guestbook
cd guestbook
```

Pour definir notre image PHP 8.1 avec les extensions et les outils dont nous avons besoin, on va definir tous cela dans un fichier `Dockerfile`, qui est un fichier sur lequel se base docker pour construire (build) des images. 

Nous utiliserons l'image officielle `php:8.1-fpm-alpine`, on choisit la version `alpine` car elle est réputé pour etre légère.
```sh
# Dockerfile
FROM php:8.1-fpm-alpine AS php
```

On donne ici un alias `php` pour pouvoir composer plusieurs build dans notre `Dockerfile`
]

---

class: middle
.left-column[
## Installations
### Docker
### Notre image PHP 8.1
#### Initialisation
#### Installation des paquets et extensions
]
.right-column[
  #### Installation des paquets
Nous allons avoir besoins de certaines libraries pour avoir un environnement complet, qui pourra faire tourner notre projet aisement.
Ajoutons-y :
* Git
* Zsh / Bash
* Nodejs
* Symfony cli

```sh
# Dockerfile
RUN apk add --no-cache $PHPIZE_DEPS git build-base zsh nodejs npm bash

# Symfony binary installation
RUN wget https://get.symfony.com/cli/installer -O - | bash && mv /root/.symfony/bin/symfony /usr/local/bin/symfony
```

On Peut avoir un prompt sexy grace à `Oh my zsh`
```sh
RUN sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
```

  #### Installation des extensions
Nous aurons besoin aussi de certaine extensions php, grace à `mlocati/php-extension-installer` qui facilite grandement l'installation des extensions et configuration. Il integre aussi `composer`.
```sh
# Php extension installation
COPY --from=mlocati/php-extension-installer /usr/bin/install-php-extensions /usr/local/bin/
RUN install-php-extensions xsl pdo_mysql intl redis amqp pgsql @composer
```

]

---

class: middle
.left-column[
## Installations
### Docker
### PHP 8.11
#### Initialisation
#### Installation des paquets et extensions
#### Projet symfony
]
.right-column[
Nous avons à present un environnment qui nous permet de travailler avec notre projet
```sh
# Dockerfile
WORKDIR /srv/app
```
Copions notre repertoire de travail directement dans l'image, grâce à cette pratique on pourra faire tourner notre projet dans le container sans avoir besoin de passer par les volumes lorque nous travaillons en local.

```sh
COPY . /tmp/app

RUN test -f /tmp/app/composer.json && echo cp -r /tmp/app ./ || echo symfony new ./ --webapp --version=6.0 --php=${PHP_VERSION}
```

Après la copie de notre on verifie que le projet symfony est initialisé via symfony-cli en verifiant la presence du fichier `composer.json`. Si ce n'est pas le cas on lance la commande `symfony new` 
]

---

class: middle
.left-column[
## Installations
### Docker
### PHP 8.1
### Composer
### Node
]
.right-column[
### Node
Voir https://github.com/nodesource/distributions/blob/master/README.md

Procedure d'installation de npm
```bash
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt-get install -y nodejs

# verifier que nodejs et npm sont bien installé
node -v
npm -v 
```

Procedure d'installation de yarn via npm
```bash
sudo npm install --global yarn

# verifier que yarn est bien installé
yarn -v
```
]

---

class: middle
.left-column[
## Installations
### Docker
### PHP 8.1
### Composer
### Node
### Symfony
]
.right-column[
### Symfony
Procdure d'installation de symfony cli, on outil devenu essentielle lors de l'étape de developpement
```bash
# téléchargement du symfony cli
wget https://get.symfony.com/cli/installer -O - | bash

# Installion global
sudo mv /home/$USER/.symfony/bin/symfony /usr/local/bin/symfony

# Verifier que symfony cli est bien installé
symfony --version
```

Nous pouvons aussi installer un certificat en local pour avoir des urls en https
```bash
symfony server:ca:install
```

Verifier que votre environmement de travail à ce qui est requis pour travailler sur symfony framework
```bash
symfony book:check-requirements
```
]

---

.left-column[
## Installations
### Docker
### PHP 8.1
### Composer
### Node
### Symfony
### vscode extension
]
.right-column[
Nous aurons besoin de certaines extension sur Vscode pour travailler correctement et facilement.

Liste des extensions
- PHP Intelephense
- PHP Namespace Resolver
- DotENV
- YAML
- PHP 8 Getter & Setter
- Extension Twig Language 2

Si vous avez la possibilité de travailler sur phpstorm c'est encore plus simple, un seul plugin sera necessaire
- Symfony support
]

---
class: center, middle, inverse
# 2. En route vers symfony 6
---

class: middle
.left-column[
## Nouveau projet symfony 6
]
.right-column[
  ### Liens vers le tutoriel
  En entendnat le tutoriel sur la version 6, on s'appuyer sur la doc de la version 5.2 en utilisant symfony 6 et php 8.1
  https://symfony.com/doc/current/the-fast-track/fr/index.html

  ### New repository symfony
  La commande suivante va permettre de cloner symfony-skeleton en local, lancer composer ...

  Noter qu'il possible d'utiliser --full pour avoir symfony avec les composant essentiel pour developper un site web.
  ```bash
  # clone du repo symfony-skeleton
  symfony new guestbook --version=6.0

  # entrer dans le repertoire
  cd guestbook

  # afficher le contenu du repertoire
  ls -al

  # afficher le repertoire de travail sur vscode
  code .
  ```
]

---

class: middle
.left-column[
### Nouveau projet symfony
### Postgresql
#### Installation
]
.right-column[
  
#### Installation de Postegresql en local
Nous n'utiliserons pas postgresql en local, mais symfony cli aura besoin sur certaines commande.
```bash
sudo apt install postgresql postgresql-contrib
```

### Installation du Client pgcli
Le client pgcli qui nous aidera a nous connecter à notre base de donnée.
```bash
# Installation
sudo apt install pgcli
```

]

---

class: middle
.left-column[
### Nouveau projet symfony
### Postgresql
#### Installation
#### Connection
]
.right-column[
#### Connect to database
Via docker-compose exec
```bash
docker-compose exec database psql -U main -d main
```
Via pgcli, use value of DATABASE_URL
```bash
pgcli postgresql://localhost:49743/app?serverVersion=13&charset=utf8
```

#### Documentation 
##### Database
https://www.postgresql.org/docs/13/tutorial-accessdb.html

##### Table & query
https://www.postgresql.org/docs/13/tutorial-table.html
]

---

class: middle
.left-column[
### Nouveau projet symfony
### Postgresql
#### Installation
#### Connection
#### Commands
]
.right-column[
| Listing | Command | Argument |
|---|---|---|
| Table, index, view, or sequence | \d | name |
| Tables | \dt | name |
| Views | \dv | name |
| Permissions | \dp or \z | name |
| System tables | \dS | name |
| Types | \dT | name |
| Functions | \df | name |
| Operators | \do | name |
| Databases | \l | name |
]

---

class: middle
.left-column[
### Nouveau projet symfony
### Postgresql
### Environemment de dev
]
.right-column[
#### Si vous rencontrer des bugs
* **1 :** N'hesitez à demander au formateur, meme si il doit se repeter.
* **2 :** Demander au gens qui vous entoure
* **3 :** Demander à Google avec la bonne manière. En clair ne faite pas un copier coller bete de votre erreur, car il ne vous repondra certainement avec les bonnes solutions. La bonne manière c'est de prefixer par la technologie que vous utiliser, puis c'est un bug et ensuite un resumé bref de votre erreur. Utiliser l'anglais vous apportera de meilleur resultat.

_**example :**_ symfony bug monolog don't work

#### Variables
Pour afficher toutes les variables d'environnement exposées 
```bash
# affiche toutes les variables (server, .env, docker, ...)
symfony var:export --debug --multiline

# afficher seulement les variables .env.*
symfony console debug:dotenv
```
]

---

class: middle
.left-column[
### Nouveau projet symfony
### Postgresql
### Environemment de dev
### Doctrine ORM
]
.right-column[
Par defaut Doctrine ORM utilise les annotations, nous allons nous utiliser les attributes qui sont fournit depuis php 8.0
```
doctrine:
    orm:
        mappings:
            App:
                type: attribute
```

Verifions que notre database est toujours presente
```bash
symfony console doctrine:database:create
```
]