class: center, middle, inverse

<img src="img/logo.png" alt="Github actions" width="400px" style="margin-bottom:4rem" />

<div class="logo"><svg class="logo-1" fill="white" width="196" height="64" viewBox="0 0 196 64" style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2;"><g transform="matrix(0.101031,0,0,0.101031,2.39526,-0.329946)"><g transform="matrix(1.27705,0,0,1.27705,1143.65,155.404)"><path d="M320.958,94.576C320.958,107.301 317.357,117.884 310.155,126.323C302.952,134.763 293.386,140.971 281.456,144.947L331.695,223.685L290.072,223.685L246.727,150.647L230.025,150.647L230.025,223.685L193.837,223.685L193.837,40.361L247.787,40.361C296.568,40.361 320.958,58.433 320.958,94.576ZM283.312,94.576C283.312,84.855 280.462,77.764 274.762,73.301C269.062,68.838 260.38,66.607 248.715,66.607L230.025,66.607L230.025,124.931L249.908,124.931C260.954,124.931 269.283,122.501 274.895,117.641C280.506,112.78 283.312,105.092 283.312,94.576Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(1.27705,0,0,1.27705,1486.87,208.548)"><path d="M313.005,64.751L241.159,227.264L208.153,217.058L277.612,67.402L195.163,67.402L195.163,40.361L313.005,40.361L313.005,64.751Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(1.27705,0,0,1.27705,1335.53,155.404)"><path d="M253.752,12.524C257.994,12.524 261.75,13.43 265.019,15.241C268.289,17.053 270.852,19.55 272.708,22.731C274.563,25.912 275.491,29.447 275.491,33.335C275.491,37.224 274.563,40.758 272.708,43.94C270.852,47.121 268.289,49.64 265.019,51.495C261.75,53.351 257.994,54.279 253.752,54.279C249.51,54.279 245.733,53.351 242.419,51.495C239.105,49.64 236.52,47.121 234.664,43.94C232.808,40.758 231.88,37.224 231.88,33.335C231.88,29.447 232.808,25.912 234.664,22.731C236.52,19.55 239.105,17.053 242.419,15.241C245.733,13.43 249.51,12.524 253.752,12.524ZM201.658,83.309L276.419,83.309L276.419,198.897L313.402,198.897L313.402,223.685L200.332,223.685L200.332,198.897L241.424,198.897L241.424,108.097L201.658,108.097L201.658,83.309Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M261.043,177.319L211.622,177.319L211.622,218.681L254.382,218.681L254.382,228.302L211.622,228.302L211.622,271.803L264.332,271.803L264.332,280.93L201.096,280.93L201.096,167.944L262.441,167.944L261.043,177.319ZM213.76,150.758L245.501,134.23L250.682,143.851L216.72,156.432L213.76,150.758Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M312.861,273.201C321.248,273.201 329.06,270.651 336.297,265.553L341.642,272.46C337.969,275.53 333.501,277.984 328.238,279.82C322.975,281.657 317.987,282.575 313.272,282.575C304.994,282.575 297.922,280.766 292.056,277.148C286.191,273.529 281.723,268.376 278.653,261.688C275.583,255 274.048,247.133 274.048,238.088C274.048,229.426 275.583,221.696 278.653,214.898C281.723,208.101 286.218,202.756 292.139,198.863C298.059,194.971 305.131,193.025 313.354,193.025C323.935,193.025 333.282,196.287 341.395,202.81L335.968,210.129C328.128,204.757 320.426,202.07 312.861,202.07C307.488,202.07 302.733,203.441 298.594,206.182C294.455,208.923 291.22,212.993 288.89,218.393C286.561,223.793 285.396,230.358 285.396,238.088C285.396,245.927 286.547,252.465 288.849,257.7C291.152,262.935 294.373,266.828 298.512,269.377C302.65,271.926 307.434,273.201 312.861,273.201Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M386.388,193.025C394.118,193.025 400.641,194.834 405.959,198.452C411.277,202.07 415.251,207.224 417.883,213.912C420.514,220.6 421.83,228.549 421.83,237.759C421.83,246.421 420.473,254.137 417.759,260.907C415.046,267.677 411.003,272.981 405.63,276.819C400.258,280.656 393.761,282.575 386.141,282.575C378.412,282.575 371.874,280.725 366.529,277.024C361.184,273.324 357.168,268.13 354.482,261.441C351.796,254.753 350.453,246.914 350.453,237.923C350.453,228.987 351.81,221.148 354.523,214.405C357.237,207.662 361.294,202.413 366.694,198.658C372.093,194.903 378.658,193.025 386.388,193.025ZM386.388,201.988C369.887,201.988 361.636,213.967 361.636,237.923C361.636,261.661 369.805,273.529 386.141,273.529C402.478,273.529 410.646,261.606 410.646,237.759C410.646,213.912 402.56,201.988 386.388,201.988Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M463.945,261.359C463.945,265.635 465.301,268.76 468.015,270.734C470.729,272.707 474.443,273.694 479.157,273.694C483.982,273.694 489.053,272.652 494.37,270.569L497.33,278.463C494.973,279.669 492.136,280.656 488.82,281.424C485.503,282.191 481.953,282.575 478.171,282.575C473.566,282.575 469.413,281.739 465.713,280.067C462.012,278.395 459.093,275.955 456.955,272.748C454.817,269.541 453.748,265.745 453.748,261.359L453.748,168.52L426.94,168.52L426.94,159.639L463.945,159.639L463.945,261.359Z" style="fill-rule: nonzero;"></path></g><g transform="matrix(2.01117,0,0,2.01117,165.834,-128.735)"><path d="M520.121,241.87C520.231,248.833 521.491,254.657 523.904,259.345C526.316,264.032 529.509,267.513 533.483,269.788C537.458,272.063 541.885,273.201 546.764,273.201C551.15,273.201 555.11,272.57 558.646,271.309C562.182,270.048 565.979,268.02 570.035,265.224L575.38,272.872C571.433,275.942 566.952,278.326 561.936,280.026C556.919,281.725 551.999,282.575 547.175,282.575C539.336,282.575 532.552,280.725 526.823,277.024C521.094,273.324 516.722,268.102 513.707,261.359C510.692,254.616 509.184,246.777 509.184,237.841C509.184,229.125 510.705,221.381 513.748,214.611C516.791,207.84 521.08,202.55 526.617,198.74C532.154,194.93 538.486,193.025 545.613,193.025C552.52,193.025 558.496,194.711 563.539,198.082C568.583,201.454 572.434,206.278 575.093,212.555C577.751,218.832 579.081,226.246 579.081,234.798C579.081,236.059 578.999,238.417 578.834,241.87L520.121,241.87ZM545.859,202.564C541.09,202.564 536.855,203.674 533.155,205.894C529.454,208.114 526.48,211.472 524.232,215.967C521.985,220.463 520.669,226.027 520.285,232.66L569.377,232.66C569.158,222.793 566.938,215.31 562.717,210.211C558.496,205.113 552.876,202.564 545.859,202.564Z" style="fill-rule: nonzero;"></path></g><path d="M250.428,75.558C385.339,75.558 494.87,185.089 494.87,320C494.87,454.911 385.339,564.442 250.428,564.442C115.517,564.442 5.986,454.911 5.986,320C5.986,185.089 115.517,75.558 250.428,75.558ZM131.233,450.023L131.233,203.31L220.202,205.493C297.709,207.676 311.355,209.314 331.55,219.685C400.87,255.709 417.79,343.587 365.937,402.536L344.65,426.552L356.658,438.014L368.12,450.023L256.772,450.023L256.772,339.22L269.872,351.228L282.972,363.782L294.434,352.32C308.08,338.674 309.171,325.575 297.163,309.2C294.835,305.797 292.624,303.334 289.625,301.561C283.483,297.931 274.034,297.192 253.497,297.192L218.564,297.192L218.564,450.023L131.233,450.023Z"></path></g></svg></div>

---

class: middle
.center[

### Programme

]
.pull-left[

* **Introduction √† GitHub Actions**

  * Pr√©sentation de GitHub Actions
  * Utilisation et avantages de l'automatisation dans le d√©veloppement logiciel
  * Comparaison avec d'autres outils d'int√©gration continue/d√©ploiement continu (CI/CD)

* **Premiers pas avec GitHub Actions**

  * Cr√©ation d'un d√©p√¥t GitHub
  * Pr√©sentation de l'interface utilisateur de GitHub Actions
  * Exploration des actions pr√©configur√©es dans le Marketplace

* **Cr√©ation d'un workflow simple**

  * Introduction aux fichiers YAML
  * Cr√©ation d'un fichier de workflow
  * Configuration des √©v√©nements d√©clencheurs (push, pull_request, etc.)
  * Ajout des √©tapes du workflow (actions)
  * Gestion des erreurs et d√©bogage

]
.pull-right[

* **Utilisation des actions communautaires**
  * Recherche et s√©lection d'actions adapt√©es √† vos besoins
  * Int√©gration d'actions communautaires dans votre workflow
  * üöß .red[**Exercice de travaux pratiques**]

* **Variables d'environnement et secrets**

  * Utilisation des variables d'environnement
  * Cr√©ation et gestion des secrets
  * Utilisation des secrets dans les workflows

* **Exemple pratique : D√©ploiement d'une application web**

  * Pr√©sentation du projet exemple
  * Mise en place d'un workflow de CI/CD pour tester l'application
  * Construire une image docker de l'application depuis le workflow
  * D√©ploiement automatique de l'application sur une plateforme (Heroku, AWS, etc.)
]

---

class: middle, inverse, center

# Introduction √† GitHub Actions

---

class: middle


Bienvenue √† cette formation sur l'introduction √† GitHub Actions ! Dans cette formation, nous allons explorer ce qu'est GitHub Actions, son utilit√© et ses avantages pour l'automatisation dans le d√©veloppement logiciel, ainsi que sa comparaison avec d'autres outils de CI/CD.

### Pr√©sentation de GitHub Actions

GitHub Actions est un outil d'automatisation int√©gr√© √† GitHub qui vous permet de d√©finir des workflows personnalis√©s pour votre projet. 

Ces workflows sont des actions qui sont d√©clench√©es par des √©v√©nements tels que :

  * La cr√©ation de nouvelles pull requests
  * la cr√©ation ou la modification de probl√®mes 
  * De commentaires sur des probl√®mes
  * M√™me en r√©ponse √† des √©v√©nements externes tels que des notifications provenant de services tiers.

Les workflows peuvent √™tre utilis√©s pour automatiser des t√¢ches telles que :

  * Les builds de projets (Java, docker, Javascript, ...)
  * Les tests
  * Le d√©ploiement 
  * Et bien plus encore.
  
Vous pouvez √©crire des actions personnalis√©es pour accomplir des t√¢ches sp√©cifiques ou utiliser des actions pr√©construites dans le march√© GitHub Actions.

---

class: middle

### Utilisation et avantages de l'automatisation dans le d√©veloppement logiciel

L'automatisation est devenue une partie int√©grante du d√©veloppement logiciel moderne. Elle peut aider √† : 

  * Acc√©l√©rer le d√©veloppement
  * R√©duire les erreurs humaines
  * Am√©liorer la qualit√© du code.

L'automatisation est particuli√®rement utile **pour les t√¢ches r√©p√©titives** telles que la compilation, les tests, le d√©ploiement et la v√©rification de la conformit√©.

L'automatisation permet √©galement aux d√©veloppeurs de se concentrer sur des t√¢ches √† plus haute valeur ajout√©e, telles que la cr√©ation de nouvelles fonctionnalit√©s, plut√¥t que de passer du temps √† effectuer des t√¢ches manuelles et fastidieuses.

.center[
  <image src="img/workflow.png" width="500" alt="Worflow" />
]

---

class: middle

### Comparaison avec d'autres outils d'int√©gration continue/d√©ploiement continu (CI/CD)

**GitHub Actions est un outil de CI/CD** relativement nouveau qui a √©t√© lanc√© en 2019. Il existe cependant de nombreux autres outils de CI/CD disponibles sur le march√©, tels que Jenkins, Travis CI, CircleCI et GitLab CI/CD.

üîπ La principale diff√©rence entre GitHub Actions et ces autres outils est qu'il est int√©gr√© directement dans GitHub, tandis que les autres outils n√©cessitent g√©n√©ralement une configuration s√©par√©e et un environnement de serveur d√©di√©.

üîπ De plus, GitHub Actions permet une grande flexibilit√© dans la d√©finition de workflows et d'actions personnalis√©es. Les workflows peuvent √™tre d√©clench√©s par n'importe quel √©v√©nement GitHub ou par des √©v√©nements externes tels que des notifications de services tiers. Cela signifie que vous pouvez automatiser pratiquement n'importe quelle t√¢che li√©e √† votre projet GitHub.

üîπ Enfin, GitHub Actions propose un march√© d'actions pr√©construites qui peuvent √™tre utilis√©es directement dans vos workflows, ce qui peut vous faire gagner du temps dans le d√©veloppement de votre propre automatisation.

#### üîµ En conclusion

GitHub Actions est un outil d'automatisation **puissant** et **flexible** qui peut aider les d√©veloppeurs √† acc√©l√©rer leur d√©veloppement, √† **r√©duire les erreurs humaines** et √† **am√©liorer la qualit√© du code.** En raison de son int√©gration directe dans GitHub et de sa grande flexibilit√©, GitHub Actions peut √™tre un choix id√©al pour les projets h√©berg√©s sur GitHub.


---

class: middle, inverse, center

# Premiers pas avec GitHub Actions

---

class: middle

Super, passons maintenant aux premiers pas avec GitHub Actions ! Dans cette partie de la formation, nous allons apprendre comment cr√©er un d√©p√¥t GitHub, comment naviguer dans l'interface utilisateur de GitHub Actions et comment explorer les actions pr√©configur√©es dans le Marketplace.

### Cr√©ation d'un d√©p√¥t GitHub

Pour commencer √† utiliser GitHub Actions, vous devez d'abord cr√©er un d√©p√¥t GitHub. Si vous n'en avez pas d√©j√† un, vous pouvez suivre les √©tapes suivantes pour en cr√©er un :

  1. Connectez-vous √† [GitHub](https://github.com/) et rendez-vous sur le template [Formation symfony template](https://github.com/mkl-devops-ri7/formation-symfony-template)
  2. Cliquez sur **"Use this template"**, puis **"Create a new Repository"**
  3. Saisissez un nom pour votre d√©p√¥t et choisissez si vous voulez le rendre public ou priv√©.
  4. Cliquez sur le bouton vert **"Create repository from template"** pour cr√©er votre d√©p√¥t.

F√©licitations, vous venez de cr√©er votre d√©p√¥t GitHub !


.center[
  <image src="img/github.webp" width="500" alt="WorflowGithub" />
]

---

class: middle

### Pr√©sentation de l'interface utilisateur de GitHub Actions

Maintenant que vous avez cr√©√© votre d√©p√¥t GitHub, vous pouvez acc√©der √† l'interface utilisateur de GitHub Actions en suivant les √©tapes suivantes :

.center[
  <image src="img/github-menu.png" width="500" alt="WorflowGithub" />
]

1. Vous pouvez voir tous **les workflows** que vous avez cr√©√©s pour votre d√©p√¥t. Les workflows sont organis√©s par dossier et peuvent √™tre d√©clench√©s par diff√©rents √©v√©nements.

2. L'affichage des derniers lancements de workflows, avec des informations sur leur √©tat et leur dur√©e.

3. Vous pouvez ajouter des nouveaux "Workflows", cette section vous permet aussi d'explorer les actions pr√©configur√©es dans **le Marketplace.**

---

class: middle

### Explorer les actions pr√©configur√©es dans le Marketplace

Le Marketplace de GitHub Actions contient des milliers d'actions pr√©configur√©es que vous pouvez utiliser dans vos workflows. Vous pouvez les trouver en suivant ces √©tapes :

.center[
  <image src="img/marketplace.png" width="500" alt="Marketplace" />
]

Lorsque vous trouvez une action que vous souhaitez utiliser, vous pouvez cliquer sur son nom pour en savoir plus sur ses fonctionnalit√©s et son utilisation. Vous pouvez √©galement voir des exemples de code pour utiliser cette action dans vos workflows.

---

class: middle, inverse, center

# Cr√©ation d'un workflow simple

---

class: middle

### Introduction aux fichiers YAML

**Les workflows** dans **GitHub Actions** sont d√©finis dans des **fichiers YAML**. YAML est un langage de configuration simple qui est souvent utilis√© pour d√©finir des structures de donn√©es. Dans GitHub Actions, les fichiers YAML sont utilis√©s pour d√©finir les √©tapes √† suivre lors de l'ex√©cution d'un workflow.

### Cr√©ation d'un fichier de workflow

Pour cr√©er un fichier de workflow, vous devez cr√©er un fichier nomm√© `nom_du_workflow.yml` dans le dossier **.github/workflows/** de votre d√©p√¥t GitHub. 

Pour g√©n√©rer notre premier workflow sur Github Action, nommer notre fichier `main.yaml`.

.center[
  <image src="img/github-arbo-workflows.png" width="500" alt="github tree workflow" />
]

---

class: middle

Voici un exemple de contenu du fichier de workflow simple que nous pouvons utiliser depuis l'interface d'√©dition de fichiers de Github  :

```yaml
name: Mon premier workflow
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Ex√©cuter une action
        uses: actions/hello-world-docker-action@v1
```

Ce fichier de workflow d√©finit un workflow nomm√© `"Mon premier workflow"`. Il est d√©clench√© par les √©v√©nements `push` et `pull_request` sur la branche `main`.

Il y a une √©tape appel√©e `build` qui s'ex√©cute sur un syst√®me d'exploitation `ubuntu-latest`. Cette √©tape utilise une action appel√©e `hello-world-docker-action` pour ex√©cuter une commande.

.center[
  <image src="img/workflow-result.png" width="500" alt="github workflow result" />
]

---

class: middle

### Configuration des √©v√©nements d√©clencheurs

Les workflows sont d√©clench√©s par des √©v√©nements sp√©cifiques tels que des pushs sur une branche ou des pull requests. Vous pouvez configurer les √©v√©nements qui d√©clenchent un workflow en utilisant la cl√© on dans le fichier YAML du workflow.

Voici un exemple de configuration pour d√©clencher un workflow sur un push sur la branche main :
  
  ```yaml
  on:
  push:
    branches:
      - main
```

Vous pouvez √©galement configurer un workflow pour se d√©clencher sur plusieurs √©v√©nements, comme un push et un pull request :

```yaml
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
```

---

class: middle

### Ajout des √©tapes du workflow (actions)

Les workflows sont compos√©s de diff√©rentes √©tapes qui sont ex√©cut√©es dans un ordre sp√©cifique. Dans GitHub Actions, les √©tapes sont appel√©es `actions`. Les actions peuvent √™tre des scripts personnalis√©s, des t√¢ches de compilation, des d√©ploiements, etc. Vous pouvez utiliser des actions pr√©configur√©es √† partir du Marketplace de GitHub Actions, ou cr√©er vos propres actions personnalis√©es.

Voici un exemple de d√©finition d'une action dans un fichier de workflow :

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    steps:
      - name: Ex√©cuter une action
        uses: actions/hello-world-docker-action@v1
      - name: Add new directory
        run: mkdir new_directory
      - name: List files
        run: ls -al
```

Dans cet exemple, l'√©tape `build` contient trois actions.

* La premi√®re action utilise une action pr√©configur√©e pour afficher un Hello World
* La deuxi√®me action ex√©cute une commande pour ajouter un dossier.
* La troisi√®me action ex√©cute une commande pour lister les fichiers

---

class: middle

### Gestion des erreurs et d√©bogage

Lorsque vous travaillez avec des workflows, il est important de savoir comment g√©rer les erreurs et les probl√®mes qui surviennent. GitHub Actions offre plusieurs fonctionnalit√©s pour vous aider √† g√©rer les erreurs et √† d√©boguer vos workflows.

#### Journal des actions

Le journal des actions est un outil utile pour comprendre ce qui se passe pendant l'ex√©cution de votre workflow. Vous pouvez acc√©der au journal des actions en cliquant sur l'onglet "Actions" dans votre d√©p√¥t GitHub.

Le journal des actions vous montre les √©tapes que votre workflow a effectu√©es, ainsi que les r√©sultats de chaque action. Vous pouvez √©galement voir les messages de sortie et les erreurs de chaque action.

#### D√©bogage des workflows

Si vous rencontrez des erreurs ou des probl√®mes avec votre workflow, vous pouvez utiliser l'outil de d√©bogage int√©gr√© de GitHub Actions. Cet outil vous permet d'ex√©cuter votre workflow en mode d√©bogage, ce qui vous permet de voir les r√©sultats de chaque action et de d√©terminer o√π se trouve le probl√®me.

Pour activer le mode d√©bogage, ajoutez simplement la cl√© debug √† votre workflow :

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Ex√©cuter une action
        uses: actions/hello-world-docker-action@v1
      with:
        debug: true
```

---

class: middle

### Notifications par e-mail

Si vous souhaitez √™tre averti par e-mail en cas d'erreur dans votre workflow, vous pouvez configurer des notifications par e-mail. Vous pouvez configurer des notifications pour un utilisateur ou une organisation sp√©cifique, et vous pouvez √©galement personnaliser le contenu de l'e-mail.

Pour configurer des notifications par e-mail, acc√©dez aux param√®tres de votre d√©p√¥t GitHub, puis cliquez sur "Notifications". Vous pouvez ensuite configurer les notifications en fonction de vos pr√©f√©rences.

### En conclusion

GitHub Actions est un outil puissant pour l'automatisation de vos workflows de d√©veloppement. Avec GitHub Actions, vous pouvez 

* Configurer des workflows personnalis√©s qui r√©pondent √† vos besoins sp√©cifiques
* Vous pouvez facilement d√©boguer les probl√®mes qui surviennent.
* Les fonctionnalit√©s de d√©bogage et de journalisation int√©gr√©es de GitHub Actions sont particuli√®rement utiles pour comprendre ce qui se passe pendant l'ex√©cution de votre workflow.

---

class: middle, inverse, center


# Utilisation des actions communautaires
---

class: middle

Une des principales caract√©ristiques de GitHub Actions est sa capacit√© √† int√©grer des actions communautaires dans vos workflows. Les actions communautaires sont des actions cr√©√©es par la communaut√© GitHub et mises √† disposition sur le Marketplace GitHub Actions.

Voici les √©tapes pour utiliser des actions communautaires dans votre workflow :

### Recherche et s√©lection d'actions adapt√©es √† vos besoins

Pour trouver des actions communautaires, acc√©dez au [Marketplace GitHub Actions](https://github.com/marketplace?type=actions) et utilisez la barre de recherche pour trouver des actions qui r√©pondent √† vos besoins.

Une fois que vous avez trouv√© une action qui r√©pond √† vos besoins, cliquez sur son nom pour acc√©der √† sa page de description. Vous pouvez y trouver des informations sur la fa√ßon d'utiliser l'action, ainsi que des exemples de workflows qui l'utilisent.

### Int√©grez l'action dans votre workflow

Pour int√©grer une action communautaire dans votre workflow, ajoutez simplement une √©tape √† votre workflow qui utilise l'action. Vous pouvez copier et coller l'exemple de code fourni sur la page de description de l'action, puis le modifier en fonction de vos besoins.

Nous identfions l'action "[Checkout](https://github.com/marketplace/actions/checkout)" commme exemple √† int√©grer, pour r√©cup√©rer le code source de votre d√©p√¥t GitHub dans l'espace de travail du workflow.

---

class: middle

Voici un workflow qui utilise l'action "Checkout" :

```yaml
name: Mon workflow
on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Listing files
        run: ls -al
```

Dans cet exemple,

* La premi√®re √©tape utilise l'action "Checkout" pour r√©cup√©rer le code source de votre d√©p√¥t GitHub.

* La deuxi√®me √©tape ex√©cute simplement une commande "ls -al" pour afficher la liste des fichiers.

---

class: middle

### üöß .red[Exercice de travaux pratiques]

Cr√©er un workflow pour cloner, installer les extensions PHP n√©cessaires et lancer un "composer install"

Dans cet exercice, vous devrez cr√©er un workflow GitHub Actions qui clonera un d√©p√¥t GitHub, installera les extensions PHP n√©cessaires et ex√©cutera la commande "composer install".

Voici les instructions pour l'exercice :

* Cr√©ez un fichier de workflow dans le r√©pertoire `.github/workflows/` de votre d√©p√¥t. Nommez le fichier `build.yml`.

* Dans le fichier `build.yml`, d√©finissez le nom du workflow et les √©v√©nements d√©clencheurs. Vous pouvez choisir `push` ou `pull_request` selon vos pr√©f√©rences.

* Ajoutez une √©tape qui utilise l'action **"Checkout"** pour cloner le d√©p√¥t GitHub dans votre workflow. Vous pouvez utiliser l'exemple de code fourni dans la documentation.

* Ajoutez une √©tape qui utilise l'action "[shivammathur/setup-php](https://github.com/marketplace/actions/setup-php-action)" pour installer les extensions PHP n√©cessaires. 
  * Cette action t√©l√©charge et installe les versions sp√©cifi√©es de PHP (8.2) et des extensions PHP, et configure l'environnement pour qu'il utilise ces versions. 
  * Vous pouvez sp√©cifier les versions et les extensions PHP dont vous avez besoin dans le fichier de configuration de l'action.

* Ajoutez une √©tape qui ex√©cute la commande "composer install" pour installer les d√©pendances PHP de votre projet.

* V√©rifiez que votre workflow ne contient pas d'erreurs en le testant avec un commit ou une pull request.

---

class: middle, inverse, center

# Variables d'environnement et secrets

---

class: middle

GitHub Actions offre la possibilit√© d'utiliser des variables d'environnement et des secrets dans vos workflows pour stocker des informations sensibles ou des valeurs qui peuvent changer en fonction de l'environnement. Dans cette section, nous allons aborder l'utilisation des variables d'environnement, la cr√©ation et la gestion des secrets, ainsi que l'utilisation des secrets dans les workflows.

### Utilisation des variables d'environnement

Les variables d'environnement sont des valeurs qui peuvent √™tre stock√©es dans votre workflow et utilis√©es par les actions que vous ex√©cutez. Vous pouvez d√©finir des variables d'environnement dans votre fichier de workflow en utilisant la syntaxe suivante :

```yaml
env:
  VARIABLE_NAME: value

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: display variable
        run: echo ${{ env.VARIABLE_NAME }}
```

Vous pouvez ensuite utiliser la variable dans vos actions en utilisant la syntaxe `${{ env.VARIABLE_NAME }}`.

---

class: middle

### Cr√©ation et gestion des secrets

**Les secrets sont des informations sensibles** telles que des cl√©s d'API, des mots de passe ou des jetons d'acc√®s. Les secrets sont stock√©s de mani√®re s√©curis√©e dans GitHub et ne peuvent √™tre utilis√©s que dans des workflows autoris√©s.

Pour cr√©er un secret, allez dans les param√®tres de votre d√©p√¥t et s√©lectionnez **"Secrets"**. Cliquez sur **"New secret"** pour ajouter un nouveau secret. Vous pouvez le nommer `SECRET_NAME` et donner une valeur √† votre secret. Une fois cr√©√©, vous pouvez utiliser votre secret dans vos workflows.

### Utilisation des secrets dans les workflows

Pour utiliser un secret dans votre workflow, vous devez d'abord le r√©f√©rencer dans votre fichier de workflow. Vous pouvez le faire en utilisant la syntaxe suivante :

```yaml
steps:
  - name: Use a Secret
    env:
      SUPER_SECRET: ${{ secrets.SECRET_NAME }}
    run: echo $SUPER_SECRET

```

Dans cet exemple, nous avons cr√©√© une √©tape nomm√©e **"Use a Secret"**. Nous avons ensuite d√©fini une variable d'environnement nomm√©e `SUPER_SECRET` qui utilise le secret que nous avons cr√©√© pr√©c√©demment en utilisant la syntaxe `${{ secrets.SECRET_NAME }}`. Nous avons ensuite ex√©cut√© la commande `echo $SUPER_SECRET` pour afficher la valeur du secret.

Vous pouvez utiliser des secrets dans n'importe quelle √©tape de votre workflow. N'oubliez pas de toujours garder les secrets en s√©curit√© et de ne pas les partager avec des personnes non autoris√©es.

---

class: middle, inverse, center

# Exemple pratique

## D√©ploiement d'une application web

---

class: middle

Dans cette section, nous allons mettre en pratique les connaissances acquises pr√©c√©demment en cr√©ant un workflow de CI/CD pour tester et d√©ployer une application web sur une plateforme de votre choix.

### Pr√©sentation du projet exemple


Notre exemple de projet est une application web d√©velopp√©e en Symfony qui utilise une base de Sqlite. Le code source du projet est h√©berg√© sur un d√©p√¥t GitHub. Notre objectif est de cr√©er un workflow de CI/CD qui effectuera les t√¢ches suivantes :

* Cloner le code source du projet depuis le d√©p√¥t GitHub

* Installer les d√©pendances PHP n√©cessaires √† l'aide de Composer

* Tester l'application √† l'aide de PHPUnit

* D√©ployer automatiquement l'application sur une plateforme cloud (Heroku, AWS, etc.) apr√®s les tests r√©ussis

---

class: middle

### Mise en place d'un workflow de CI/CD pour tester l'application

.pull-left[
  Voici un exemple de fichier de workflow YAML qui pourrait √™tre utilis√© pour notre exemple de projet :

  ```yaml
  name: CI/CD workflow

  on:
    push:
      branches: [ main ]

  jobs:
    build:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout code
          uses: actions/checkout@v2

        - name: Install dependencies
          run: composer install

        - name: Run tests
          run: ./vendor/bin/phpunit
  ```
]
.pull-right[
  Dans ce fichier de workflow, nous avons d√©fini un travail (**"job"**) nomm√© **"build"** qui sera d√©clench√© lorsque des modifications sont pouss√©es sur la branche **"main"**.
  
  Nous avons ensuite d√©fini les √©tapes du travail qui cloneront le code source, installeront les d√©pendances PHP, ex√©cuteront les tests avec PHPUnit.

  .center[
    <image src="img/github-workflow-1.png" width="500" alt="github workflow result" />
  ]
]


---

class: middle

.center[
### **Construire une image docker de l'application depuis le workflow Github**
]

Dans cette partie, nous allons explorer la possibilit√© de construire une image Docker de votre application √† partir de votre workflow GitHub.
Cela vous permettra de g√©n√©rer facilement des images pr√™tes √† √™tre d√©ploy√©es sur diff√©rentes plates-formes ou environnements.

Voici les √©tapes pour construire une image Docker de votre application depuis votre workflow GitHub :

- Assurez-vous d'avoir un fichier `Dockerfile` dans votre d√©p√¥t GitHub. Ce fichier contient les instructions n√©cessaires pour construire votre image Docker.

- Dans votre fichier de workflow GitHub, ajoutez une √©tape qui utilise l'action `docker/login-action@v2`. Cette action permet le login vers [Docker Hub](https://hub.docker.com).

- Et ajoutez une √©tape qui utilise l'action `docker/build-push-action`. Cette action simplifie la construction et le push de l'image Docker.

- D√©finissez les variables secrets `DOCKERHUB_USERNAME` et `DOCKERHUB_TOKEN` dans Github.

---

class: middle

Voici un exemple de code pour cette √©tape :

```yaml
- name: Login to Docker Hub
  uses: docker/login-action@v2
  with:
    username: ${{ secrets.DOCKERHUB_USERNAME }}
    password: ${{ secrets.DOCKERHUB_TOKEN }}
- name: Build and push Docker image
  uses: docker/build-push-action@v4
  with:
    context: .
    push: true
    tags: <your-dockerhub-username>/<your-image-name>:latest
```

Dans cet exemple, l'action `docker/build-push-action` est utilis√©e pour construire et pousser l'image Docker. Assurez-vous de remplacer `your-dockerhub-username` et `your-image-name` par vos propres informations.

* Cette √©tape utilise le contexte actuel `.` comme r√©pertoire de construction pour l'image Docker. Assurez-vous que votre `Dockerfile` et les fichiers n√©cessaires sont pr√©sents dans ce r√©pertoire.
* Vous pouvez √©galement sp√©cifier des balises `tags` suppl√©mentaires pour votre image Docker, par exemple pour marquer des versions sp√©cifiques de votre application.
* Assurez-vous que vous avez configur√© les informations d'identification Docker dans vos secrets GitHub. Vous devrez ajouter les secrets `DOCKER_USERNAME` et `DOCKER_PASSWORD` avec vos informations d'identification [DockerHub](https://hub.docker.com).

---

class: middle

.center[
### **Tester l'image Docker construite depuis le workflow Github**
]

.pull-left[
Une fois que vous avez ajout√© cette √©tape √† votre fichier de workflow, le processus de construction de l'image Docker sera d√©clench√© √† chaque fois que vous effectuez un push sur votre d√©p√¥t. L'image Docker sera construite et pouss√©e vers le registre DockerHub.

N'oubliez pas de personnaliser ces √©tapes en fonction de votre configuration Docker et des plateformes que vous utilisez pour le d√©ploiement de votre application. Vous pouvez √©galement ajouter d'autres √©tapes √† votre workflow, telles que des tests suppl√©mentaires ou des √©tapes de d√©ploiement sur des plates-formes sp√©cifiques.

La construction d'une image Docker depuis votre workflow GitHub facilite le processus de d√©ploiement de votre application dans des environnements conteneuris√©s et peut am√©liorer l'efficacit√© de votre pipeline de d√©veloppement.

Voici un example de mise en place de notre image :

```sh
docker pull your-dockerhub-username/your-image-name:latest
docker rm -f your-image-name
docker run -d -p "8080:80" -e APP_ENV=dev --name=your-image-name your-dockerhub-username/your-image-name:latest
```


]
.pull-right[
  .center[
    <image src="img/github-workflow-2.png" width="500" alt="github workflow result" />
  ]
]

---

class: middle
.center[
### **Configurer notre serveur VPS pour le d√©ploiement de l'application**
]

Nous allons installer sur le VPS les outils n√©cessaires pour le d√©ploiement de notre application. Notre VPS est sous Debian 12.

**Pour cela, nous allons dans un premier temps installer Docker (https://docs.docker.com/engine/install/debian/)**

- Mettre √† jour le syst√®me et ajouter les d√©pendances n√©cessaires :
  ```sh
  sudo apt-get update
  sudo apt-get install ca-certificates curl
  sudo install -m 0755 -d /etc/apt/keyrings
  sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
  sudo chmod a+r /etc/apt/keyrings/docker.asc
  
  # Add the repository to Apt sources:
  echo \
    "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
    $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
    sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  sudo apt-get update
  ```

- Installer le packet docker engine
  ```shell
  sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
  ```

- Donner les droits √† l'utilisateur courant pour lancer les commandes docker (https://docs.docker.com/engine/install/linux-postinstall/)
  ```shell
    sudo usermod -aG docker $USER
  ```

- Tester l'installation
  ```shell
  docker --version
  docker compose --version
  
  ```

---

class: middle

**G√©n√©rer les cl√©s SSH pour la connexion au serveur VPS**

Pour se connecter √† notre serveur VPS, nous allons g√©n√©rer une paire de cl√©s SSH. Pour cela, nous allons utiliser la commande `ssh-keygen` sur notre machine locale.

```shell
ssh-keygen -t rsa -b 4096 -C "
```

Cette commande g√©n√©rera une paire de cl√©s SSH publique et priv√©e dans le r√©pertoire `~/.ssh`. Vous pouvez sp√©cifier un nom de fichier pour les cl√©s si vous le souhaitez.

**Copier la cl√© publique sur le serveur VPS**

Pour vous connecter √† votre serveur VPS √† l'aide de la cl√© SSH, vous devez copier la cl√© publique sur le serveur. Vous pouvez le faire en utilisant la commande `ssh-copy-id` :

```shell
ssh-copy-id user@server_ip
```

---

class: middle
**Installation de Caddy server pour le reverse proxy**

Pour d√©ployer notre application sur le serveur VPS, nous allons utiliser Caddy Server comme reverse proxy. Caddy Server est un serveur web open source qui prend en charge le HTTPS automatique et la configuration facile du reverse proxy.

```shell
sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https curl
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list
sudo apt update
sudo apt install caddy
```

___

class: middle
.center[
### **D√©ploiement automatique de l'application sur un VPS**
]

Dans cette partie, nous allons explorer la possibilit√© de d√©ployer automatiquement votre application sur un serveur VPS √† partir de votre workflow GitHub.
Cela vous permettra de d√©ployer rapidement et facilement votre application sur un serveur distant.



